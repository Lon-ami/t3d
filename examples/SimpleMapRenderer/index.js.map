{"version":3,"sources":["SimpleMapRenderer/node_modules/browser-pack/_prelude.js","SimpleMapRenderer/src/SimpleMapRenderer/index.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/// This example is very inspired by the ModelRenderer example but updated\n/// using the latest version of the API. This global object for the app contains\n/// all the important data.\nconst cleanMapData = {\n  id: null,\n  mapFile: null,\n  terrain: {\n    data: [],\n  },\n  props: {\n    enabled: false,\n    loaded: false,\n    data: [],\n  },\n};\n\nconst mapRenderer = {\n  /// All renderers must have access to a LocalReader.\n  /// The LocalReader is the object that allows us\n  /// to read from the .dat\n  localReader: null,\n\n  /// The context is an object all the renderer outputs their data to\n  context: null,\n\n  /// THREE js objects\n  scene: null,\n  camera: null,\n  renderer: null,\n  mouse: null,\n  controls: null,\n\n  /// Data:\n  mapData: Object.assign({}, cleanMapData),\n};\n\n/// Extend Original Logger\nconst myLogger = {\n  lastMessageType: null,\n  log: function () {\n    const htmlOutput = $(\"#log\");\n    const str = Array.prototype.slice.call(arguments, 1).join(\" \");\n    if (arguments[1] === myLogger.lastMessageType) {\n      $(\"#log p:last-of-type\")[0].innerHTML = str;\n    } else {\n      htmlOutput.append($(\"<p>-------------</p>\"));\n      htmlOutput.append($(\"<p>\" + str + \"</p>\"));\n    }\n    htmlOutput[0].scrollTop = htmlOutput[0].scrollHeight;\n    myLogger.lastMessageType = arguments[1];\n  },\n};\n\n$(document).ready(function () {\n  /// Build TREE scene\n  setupScene();\n\n  /// Handle file pick\n  $(\"#filePicker\").change(function (evt) {\n    const file = evt.target.files[0];\n\n    mapRenderer.localReader = T3D.getLocalReader(file, onReaderCreated, \"../static/t3dworker.js\", myLogger);\n  });\n\n  /// Handle button click\n  $(\"#loadMapBtn\").click(onLoadMapClick);\n});\n\n/// Callback for when the LocalReader has finished setting up!\nasync function onReaderCreated() {\n  $(\"#fileIdInput\").removeAttr(\"disabled\");\n  $(\"#fileMapSelect\").removeAttr(\"disabled\");\n  $(\"#loadMapBtn\").removeAttr(\"disabled\");\n\n  const opt = document.createElement(\"option\");\n  opt.value = undefined;\n  opt.innerHTML = \"\"; // whatever property it has\n  $(\"#fileMapSelect\").append(opt);\n\n  const mapFileList = await mapRenderer.localReader.getMapList();\n  const categoryList = mapFileList.reduce((list, map) => {\n    if (!list.includes(map.category)) {\n      list.push(map.category);\n    }\n    return list;\n  }, []);\n  for (const category of categoryList) {\n    const opt = document.createElement(\"option\");\n    opt.disabled = true;\n    opt.innerHTML = category;\n    $(\"#fileMapSelect\").append(opt);\n\n    for (const map of mapFileList.filter((m) => m.category === category)) {\n      const opt = document.createElement(\"option\");\n      opt.value = map.baseId;\n      opt.innerHTML = map.name; // whatever property it has\n\n      // then append it to the select element\n      $(\"#fileMapSelect\").append(opt);\n    }\n  }\n}\n\n/// The insterresting part!\nfunction onLoadMapClick() {\n  // Clean previous render states\n  mapRenderer.mapData = Object.assign({}, cleanMapData);\n\n  /// Get selected file id\n  mapRenderer.mapData.id = $(\"#fileIdInput\").val();\n\n  /// Renderer settings (see the documentation of each Renderer for details)\n  const renderers = [\n    {\n      renderClass: T3D.EnvironmentRenderer,\n      settings: {},\n    },\n    {\n      renderClass: T3D.TerrainRenderer,\n      settings: {},\n    },\n    {\n      renderClass: T3D.PropertiesRenderer,\n      settings: {\n        visible: true,\n        showUnmaterialized: true,\n      },\n    },\n  ];\n\n  /// Setup the logger (hacky way because very verbose)\n  T3D.Logger.logFunctions[T3D.Logger.TYPE_PROGRESS] = function () {\n    myLogger.log(arguments[0], arguments[0], arguments[1]);\n    console.log(arguments[0], arguments[1]);\n  };\n\n  /// Load for the first time the renderer and spawn the context\n  T3D.renderMapContentsAsync(mapRenderer.localReader, mapRenderer.mapData.id, renderers, onRendererDone, myLogger);\n\n  /// And store the mapfile for future use\n  loadMapFile(mapRenderer.mapData.id, function (data) {\n    mapRenderer.mapData.mapFile = data;\n  });\n}\n\n/// Runs when the ModelRenderer is finshed\nfunction onRendererDone(context) {\n  document.addEventListener(\"mousemove\", onMouseMove, false);\n  cleanScene();\n\n  /// Populate our context with the context returned\n  mapRenderer.context = context;\n\n  /// Take all the terrain tiles generated by the TerrainRenderer and add them to the scene\n  for (const elem of T3D.getContextValue(context, T3D.TerrainRenderer, \"terrainTiles\")) {\n    mapRenderer.scene.add(elem);\n    mapRenderer.mapData.terrain.data.push(elem);\n  }\n\n  /// Skybox\n  const hazeColor = T3D.getContextValue(context, T3D.EnvironmentRenderer, \"hazeColor\");\n  if (hazeColor) {\n    mapRenderer.renderer.setClearColor(new THREE.Color(hazeColor[2] / 255, hazeColor[1] / 255, hazeColor[0] / 255));\n  }\n\n  /// Add the water level to the scene\n  const water = T3D.getContextValue(context, T3D.TerrainRenderer, \"water\");\n  mapRenderer.scene.add(water);\n  mapRenderer.mapData.terrain.data.push(water);\n\n  /// Move the camera initial place depending on the map bounds\n  const bounds = T3D.getContextValue(context, T3D.TerrainRenderer, \"bounds\");\n  mapRenderer.camera.position.x = 0;\n  mapRenderer.camera.position.y = bounds ? bounds.y2 : 0;\n  mapRenderer.camera.position.z = 0;\n\n  /// Add all the meshes from the prop renderer\n  const propsMeshes = T3D.getContextValue(context, T3D.PropertiesRenderer, \"meshes\");\n  for (const elem of propsMeshes) {\n    mapRenderer.scene.add(elem);\n    mapRenderer.mapData.props.data.push(elem);\n  }\n}\n\n/// It's usually not needed to keep the mapFile independently but\n/// because we're loading the colision/props/zone models manually, it is.\nfunction loadMapFile(fileId, callback) {\n  if (parseInt(fileId)) {\n    mapRenderer.localReader.loadFile(fileId, function (arrayBuffer) {\n      const ds = new DataStream(arrayBuffer, 0, DataStream.LITTLE_ENDIAN);\n      const mapFile = new T3D.GW2File(ds, 0);\n      callback(mapFile);\n    });\n  }\n}\n\n/// Wipes out the data\nfunction cleanScene() {\n  for (const type of [\"terrain\", \"props\"]) {\n    for (const elem of mapRenderer.mapData[type].data) {\n      mapRenderer.scene.remove(elem);\n    }\n    mapRenderer.mapData[type].data = [];\n  }\n\n  for (const type of [\"props\"]) {\n    mapRenderer.mapData[type].loaded = false;\n    mapRenderer.mapData[type].enabled = false;\n  }\n}\n\nfunction onMouseMove(event) {\n  const canvasBounds = mapRenderer.renderer.domElement.getBoundingClientRect();\n  mapRenderer.mouse.x = ((event.clientX - canvasBounds.left) / (canvasBounds.right - canvasBounds.left)) * 2 - 1;\n  mapRenderer.mouse.y = -((event.clientY - canvasBounds.top) / (canvasBounds.bottom - canvasBounds.top)) * 2 + 1;\n}\n\n/// Basic THREE stuff, don't mind it\nfunction setupScene() {\n  const canvasWidth = 800;\n  const canvasHeight = 800;\n  const canvasClearColor = 0x342920; // For happy rendering, always use Van Dyke Brown.\n  const fov = 60;\n  const aspect = 1;\n\n  mapRenderer.camera = new THREE.PerspectiveCamera(fov, aspect, 0.1, 100000);\n  mapRenderer.scene = new THREE.Scene();\n  mapRenderer.mouse = new THREE.Vector2();\n\n  /// This scene has one ambient light source and three directional lights\n  const ambientLight = new THREE.AmbientLight(0x555555);\n  mapRenderer.scene.add(ambientLight);\n\n  const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);\n  directionalLight1.position.set(0, 0, 1);\n  mapRenderer.scene.add(directionalLight1);\n\n  const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.8);\n  directionalLight2.position.set(1, 0, 0);\n  mapRenderer.scene.add(directionalLight2);\n\n  const directionalLight3 = new THREE.DirectionalLight(0xffffff, 0.8);\n  directionalLight3.position.set(0, 1, 0);\n  mapRenderer.scene.add(directionalLight3);\n\n  /// Standard THREE renderer with AA\n  mapRenderer.renderer = new THREE.WebGLRenderer({\n    antialiasing: true,\n    logarithmicDepthBuffer: true,\n  });\n  document.body.appendChild(mapRenderer.renderer.domElement);\n  mapRenderer.renderer.setSize(canvasWidth, canvasHeight);\n  mapRenderer.renderer.setClearColor(canvasClearColor);\n\n  setupController();\n\n  /// Note: constant continous rendering from page load\n  render();\n}\n\nfunction setupController() {\n  if (!mapRenderer.controls) {\n    const controls = new THREE.OrbitControls(mapRenderer.camera, mapRenderer.renderer.domElement);\n    controls.enableZoom = true;\n    mapRenderer.controls = controls;\n  }\n}\n\nfunction render() {\n  window.requestAnimationFrame(render);\n  mapRenderer.renderer.render(mapRenderer.scene, mapRenderer.camera);\n}\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvU2ltcGxlTWFwUmVuZGVyZXIvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIvLy8gVGhpcyBleGFtcGxlIGlzIHZlcnkgaW5zcGlyZWQgYnkgdGhlIE1vZGVsUmVuZGVyZXIgZXhhbXBsZSBidXQgdXBkYXRlZFxuLy8vIHVzaW5nIHRoZSBsYXRlc3QgdmVyc2lvbiBvZiB0aGUgQVBJLiBUaGlzIGdsb2JhbCBvYmplY3QgZm9yIHRoZSBhcHAgY29udGFpbnNcbi8vLyBhbGwgdGhlIGltcG9ydGFudCBkYXRhLlxuY29uc3QgY2xlYW5NYXBEYXRhID0ge1xuICBpZDogbnVsbCxcbiAgbWFwRmlsZTogbnVsbCxcbiAgdGVycmFpbjoge1xuICAgIGRhdGE6IFtdLFxuICB9LFxuICBwcm9wczoge1xuICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgIGxvYWRlZDogZmFsc2UsXG4gICAgZGF0YTogW10sXG4gIH0sXG59O1xuXG5jb25zdCBtYXBSZW5kZXJlciA9IHtcbiAgLy8vIEFsbCByZW5kZXJlcnMgbXVzdCBoYXZlIGFjY2VzcyB0byBhIExvY2FsUmVhZGVyLlxuICAvLy8gVGhlIExvY2FsUmVhZGVyIGlzIHRoZSBvYmplY3QgdGhhdCBhbGxvd3MgdXNcbiAgLy8vIHRvIHJlYWQgZnJvbSB0aGUgLmRhdFxuICBsb2NhbFJlYWRlcjogbnVsbCxcblxuICAvLy8gVGhlIGNvbnRleHQgaXMgYW4gb2JqZWN0IGFsbCB0aGUgcmVuZGVyZXIgb3V0cHV0cyB0aGVpciBkYXRhIHRvXG4gIGNvbnRleHQ6IG51bGwsXG5cbiAgLy8vIFRIUkVFIGpzIG9iamVjdHNcbiAgc2NlbmU6IG51bGwsXG4gIGNhbWVyYTogbnVsbCxcbiAgcmVuZGVyZXI6IG51bGwsXG4gIG1vdXNlOiBudWxsLFxuICBjb250cm9sczogbnVsbCxcblxuICAvLy8gRGF0YTpcbiAgbWFwRGF0YTogT2JqZWN0LmFzc2lnbih7fSwgY2xlYW5NYXBEYXRhKSxcbn07XG5cbi8vLyBFeHRlbmQgT3JpZ2luYWwgTG9nZ2VyXG5jb25zdCBteUxvZ2dlciA9IHtcbiAgbGFzdE1lc3NhZ2VUeXBlOiBudWxsLFxuICBsb2c6IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBodG1sT3V0cHV0ID0gJChcIiNsb2dcIik7XG4gICAgY29uc3Qgc3RyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKS5qb2luKFwiIFwiKTtcbiAgICBpZiAoYXJndW1lbnRzWzFdID09PSBteUxvZ2dlci5sYXN0TWVzc2FnZVR5cGUpIHtcbiAgICAgICQoXCIjbG9nIHA6bGFzdC1vZi10eXBlXCIpWzBdLmlubmVySFRNTCA9IHN0cjtcbiAgICB9IGVsc2Uge1xuICAgICAgaHRtbE91dHB1dC5hcHBlbmQoJChcIjxwPi0tLS0tLS0tLS0tLS08L3A+XCIpKTtcbiAgICAgIGh0bWxPdXRwdXQuYXBwZW5kKCQoXCI8cD5cIiArIHN0ciArIFwiPC9wPlwiKSk7XG4gICAgfVxuICAgIGh0bWxPdXRwdXRbMF0uc2Nyb2xsVG9wID0gaHRtbE91dHB1dFswXS5zY3JvbGxIZWlnaHQ7XG4gICAgbXlMb2dnZXIubGFzdE1lc3NhZ2VUeXBlID0gYXJndW1lbnRzWzFdO1xuICB9LFxufTtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAvLy8gQnVpbGQgVFJFRSBzY2VuZVxuICBzZXR1cFNjZW5lKCk7XG5cbiAgLy8vIEhhbmRsZSBmaWxlIHBpY2tcbiAgJChcIiNmaWxlUGlja2VyXCIpLmNoYW5nZShmdW5jdGlvbiAoZXZ0KSB7XG4gICAgY29uc3QgZmlsZSA9IGV2dC50YXJnZXQuZmlsZXNbMF07XG5cbiAgICBtYXBSZW5kZXJlci5sb2NhbFJlYWRlciA9IFQzRC5nZXRMb2NhbFJlYWRlcihmaWxlLCBvblJlYWRlckNyZWF0ZWQsIFwiLi4vc3RhdGljL3QzZHdvcmtlci5qc1wiLCBteUxvZ2dlcik7XG4gIH0pO1xuXG4gIC8vLyBIYW5kbGUgYnV0dG9uIGNsaWNrXG4gICQoXCIjbG9hZE1hcEJ0blwiKS5jbGljayhvbkxvYWRNYXBDbGljayk7XG59KTtcblxuLy8vIENhbGxiYWNrIGZvciB3aGVuIHRoZSBMb2NhbFJlYWRlciBoYXMgZmluaXNoZWQgc2V0dGluZyB1cCFcbmFzeW5jIGZ1bmN0aW9uIG9uUmVhZGVyQ3JlYXRlZCgpIHtcbiAgJChcIiNmaWxlSWRJbnB1dFwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG4gICQoXCIjZmlsZU1hcFNlbGVjdFwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG4gICQoXCIjbG9hZE1hcEJ0blwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG5cbiAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgb3B0LnZhbHVlID0gdW5kZWZpbmVkO1xuICBvcHQuaW5uZXJIVE1MID0gXCJcIjsgLy8gd2hhdGV2ZXIgcHJvcGVydHkgaXQgaGFzXG4gICQoXCIjZmlsZU1hcFNlbGVjdFwiKS5hcHBlbmQob3B0KTtcblxuICBjb25zdCBtYXBGaWxlTGlzdCA9IGF3YWl0IG1hcFJlbmRlcmVyLmxvY2FsUmVhZGVyLmdldE1hcExpc3QoKTtcbiAgY29uc3QgY2F0ZWdvcnlMaXN0ID0gbWFwRmlsZUxpc3QucmVkdWNlKChsaXN0LCBtYXApID0+IHtcbiAgICBpZiAoIWxpc3QuaW5jbHVkZXMobWFwLmNhdGVnb3J5KSkge1xuICAgICAgbGlzdC5wdXNoKG1hcC5jYXRlZ29yeSk7XG4gICAgfVxuICAgIHJldHVybiBsaXN0O1xuICB9LCBbXSk7XG4gIGZvciAoY29uc3QgY2F0ZWdvcnkgb2YgY2F0ZWdvcnlMaXN0KSB7XG4gICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICBvcHQuZGlzYWJsZWQgPSB0cnVlO1xuICAgIG9wdC5pbm5lckhUTUwgPSBjYXRlZ29yeTtcbiAgICAkKFwiI2ZpbGVNYXBTZWxlY3RcIikuYXBwZW5kKG9wdCk7XG5cbiAgICBmb3IgKGNvbnN0IG1hcCBvZiBtYXBGaWxlTGlzdC5maWx0ZXIoKG0pID0+IG0uY2F0ZWdvcnkgPT09IGNhdGVnb3J5KSkge1xuICAgICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICAgIG9wdC52YWx1ZSA9IG1hcC5iYXNlSWQ7XG4gICAgICBvcHQuaW5uZXJIVE1MID0gbWFwLm5hbWU7IC8vIHdoYXRldmVyIHByb3BlcnR5IGl0IGhhc1xuXG4gICAgICAvLyB0aGVuIGFwcGVuZCBpdCB0byB0aGUgc2VsZWN0IGVsZW1lbnRcbiAgICAgICQoXCIjZmlsZU1hcFNlbGVjdFwiKS5hcHBlbmQob3B0KTtcbiAgICB9XG4gIH1cbn1cblxuLy8vIFRoZSBpbnN0ZXJyZXN0aW5nIHBhcnQhXG5mdW5jdGlvbiBvbkxvYWRNYXBDbGljaygpIHtcbiAgLy8gQ2xlYW4gcHJldmlvdXMgcmVuZGVyIHN0YXRlc1xuICBtYXBSZW5kZXJlci5tYXBEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgY2xlYW5NYXBEYXRhKTtcblxuICAvLy8gR2V0IHNlbGVjdGVkIGZpbGUgaWRcbiAgbWFwUmVuZGVyZXIubWFwRGF0YS5pZCA9ICQoXCIjZmlsZUlkSW5wdXRcIikudmFsKCk7XG5cbiAgLy8vIFJlbmRlcmVyIHNldHRpbmdzIChzZWUgdGhlIGRvY3VtZW50YXRpb24gb2YgZWFjaCBSZW5kZXJlciBmb3IgZGV0YWlscylcbiAgY29uc3QgcmVuZGVyZXJzID0gW1xuICAgIHtcbiAgICAgIHJlbmRlckNsYXNzOiBUM0QuRW52aXJvbm1lbnRSZW5kZXJlcixcbiAgICAgIHNldHRpbmdzOiB7fSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHJlbmRlckNsYXNzOiBUM0QuVGVycmFpblJlbmRlcmVyLFxuICAgICAgc2V0dGluZ3M6IHt9LFxuICAgIH0sXG4gICAge1xuICAgICAgcmVuZGVyQ2xhc3M6IFQzRC5Qcm9wZXJ0aWVzUmVuZGVyZXIsXG4gICAgICBzZXR0aW5nczoge1xuICAgICAgICB2aXNpYmxlOiB0cnVlLFxuICAgICAgICBzaG93VW5tYXRlcmlhbGl6ZWQ6IHRydWUsXG4gICAgICB9LFxuICAgIH0sXG4gIF07XG5cbiAgLy8vIFNldHVwIHRoZSBsb2dnZXIgKGhhY2t5IHdheSBiZWNhdXNlIHZlcnkgdmVyYm9zZSlcbiAgVDNELkxvZ2dlci5sb2dGdW5jdGlvbnNbVDNELkxvZ2dlci5UWVBFX1BST0dSRVNTXSA9IGZ1bmN0aW9uICgpIHtcbiAgICBteUxvZ2dlci5sb2coYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSk7XG4gICAgY29uc29sZS5sb2coYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0pO1xuICB9O1xuXG4gIC8vLyBMb2FkIGZvciB0aGUgZmlyc3QgdGltZSB0aGUgcmVuZGVyZXIgYW5kIHNwYXduIHRoZSBjb250ZXh0XG4gIFQzRC5yZW5kZXJNYXBDb250ZW50c0FzeW5jKG1hcFJlbmRlcmVyLmxvY2FsUmVhZGVyLCBtYXBSZW5kZXJlci5tYXBEYXRhLmlkLCByZW5kZXJlcnMsIG9uUmVuZGVyZXJEb25lLCBteUxvZ2dlcik7XG5cbiAgLy8vIEFuZCBzdG9yZSB0aGUgbWFwZmlsZSBmb3IgZnV0dXJlIHVzZVxuICBsb2FkTWFwRmlsZShtYXBSZW5kZXJlci5tYXBEYXRhLmlkLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgIG1hcFJlbmRlcmVyLm1hcERhdGEubWFwRmlsZSA9IGRhdGE7XG4gIH0pO1xufVxuXG4vLy8gUnVucyB3aGVuIHRoZSBNb2RlbFJlbmRlcmVyIGlzIGZpbnNoZWRcbmZ1bmN0aW9uIG9uUmVuZGVyZXJEb25lKGNvbnRleHQpIHtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBvbk1vdXNlTW92ZSwgZmFsc2UpO1xuICBjbGVhblNjZW5lKCk7XG5cbiAgLy8vIFBvcHVsYXRlIG91ciBjb250ZXh0IHdpdGggdGhlIGNvbnRleHQgcmV0dXJuZWRcbiAgbWFwUmVuZGVyZXIuY29udGV4dCA9IGNvbnRleHQ7XG5cbiAgLy8vIFRha2UgYWxsIHRoZSB0ZXJyYWluIHRpbGVzIGdlbmVyYXRlZCBieSB0aGUgVGVycmFpblJlbmRlcmVyIGFuZCBhZGQgdGhlbSB0byB0aGUgc2NlbmVcbiAgZm9yIChjb25zdCBlbGVtIG9mIFQzRC5nZXRDb250ZXh0VmFsdWUoY29udGV4dCwgVDNELlRlcnJhaW5SZW5kZXJlciwgXCJ0ZXJyYWluVGlsZXNcIikpIHtcbiAgICBtYXBSZW5kZXJlci5zY2VuZS5hZGQoZWxlbSk7XG4gICAgbWFwUmVuZGVyZXIubWFwRGF0YS50ZXJyYWluLmRhdGEucHVzaChlbGVtKTtcbiAgfVxuXG4gIC8vLyBTa3lib3hcbiAgY29uc3QgaGF6ZUNvbG9yID0gVDNELmdldENvbnRleHRWYWx1ZShjb250ZXh0LCBUM0QuRW52aXJvbm1lbnRSZW5kZXJlciwgXCJoYXplQ29sb3JcIik7XG4gIGlmIChoYXplQ29sb3IpIHtcbiAgICBtYXBSZW5kZXJlci5yZW5kZXJlci5zZXRDbGVhckNvbG9yKG5ldyBUSFJFRS5Db2xvcihoYXplQ29sb3JbMl0gLyAyNTUsIGhhemVDb2xvclsxXSAvIDI1NSwgaGF6ZUNvbG9yWzBdIC8gMjU1KSk7XG4gIH1cblxuICAvLy8gQWRkIHRoZSB3YXRlciBsZXZlbCB0byB0aGUgc2NlbmVcbiAgY29uc3Qgd2F0ZXIgPSBUM0QuZ2V0Q29udGV4dFZhbHVlKGNvbnRleHQsIFQzRC5UZXJyYWluUmVuZGVyZXIsIFwid2F0ZXJcIik7XG4gIG1hcFJlbmRlcmVyLnNjZW5lLmFkZCh3YXRlcik7XG4gIG1hcFJlbmRlcmVyLm1hcERhdGEudGVycmFpbi5kYXRhLnB1c2god2F0ZXIpO1xuXG4gIC8vLyBNb3ZlIHRoZSBjYW1lcmEgaW5pdGlhbCBwbGFjZSBkZXBlbmRpbmcgb24gdGhlIG1hcCBib3VuZHNcbiAgY29uc3QgYm91bmRzID0gVDNELmdldENvbnRleHRWYWx1ZShjb250ZXh0LCBUM0QuVGVycmFpblJlbmRlcmVyLCBcImJvdW5kc1wiKTtcbiAgbWFwUmVuZGVyZXIuY2FtZXJhLnBvc2l0aW9uLnggPSAwO1xuICBtYXBSZW5kZXJlci5jYW1lcmEucG9zaXRpb24ueSA9IGJvdW5kcyA/IGJvdW5kcy55MiA6IDA7XG4gIG1hcFJlbmRlcmVyLmNhbWVyYS5wb3NpdGlvbi56ID0gMDtcblxuICAvLy8gQWRkIGFsbCB0aGUgbWVzaGVzIGZyb20gdGhlIHByb3AgcmVuZGVyZXJcbiAgY29uc3QgcHJvcHNNZXNoZXMgPSBUM0QuZ2V0Q29udGV4dFZhbHVlKGNvbnRleHQsIFQzRC5Qcm9wZXJ0aWVzUmVuZGVyZXIsIFwibWVzaGVzXCIpO1xuICBmb3IgKGNvbnN0IGVsZW0gb2YgcHJvcHNNZXNoZXMpIHtcbiAgICBtYXBSZW5kZXJlci5zY2VuZS5hZGQoZWxlbSk7XG4gICAgbWFwUmVuZGVyZXIubWFwRGF0YS5wcm9wcy5kYXRhLnB1c2goZWxlbSk7XG4gIH1cbn1cblxuLy8vIEl0J3MgdXN1YWxseSBub3QgbmVlZGVkIHRvIGtlZXAgdGhlIG1hcEZpbGUgaW5kZXBlbmRlbnRseSBidXRcbi8vLyBiZWNhdXNlIHdlJ3JlIGxvYWRpbmcgdGhlIGNvbGlzaW9uL3Byb3BzL3pvbmUgbW9kZWxzIG1hbnVhbGx5LCBpdCBpcy5cbmZ1bmN0aW9uIGxvYWRNYXBGaWxlKGZpbGVJZCwgY2FsbGJhY2spIHtcbiAgaWYgKHBhcnNlSW50KGZpbGVJZCkpIHtcbiAgICBtYXBSZW5kZXJlci5sb2NhbFJlYWRlci5sb2FkRmlsZShmaWxlSWQsIGZ1bmN0aW9uIChhcnJheUJ1ZmZlcikge1xuICAgICAgY29uc3QgZHMgPSBuZXcgRGF0YVN0cmVhbShhcnJheUJ1ZmZlciwgMCwgRGF0YVN0cmVhbS5MSVRUTEVfRU5ESUFOKTtcbiAgICAgIGNvbnN0IG1hcEZpbGUgPSBuZXcgVDNELkdXMkZpbGUoZHMsIDApO1xuICAgICAgY2FsbGJhY2sobWFwRmlsZSk7XG4gICAgfSk7XG4gIH1cbn1cblxuLy8vIFdpcGVzIG91dCB0aGUgZGF0YVxuZnVuY3Rpb24gY2xlYW5TY2VuZSgpIHtcbiAgZm9yIChjb25zdCB0eXBlIG9mIFtcInRlcnJhaW5cIiwgXCJwcm9wc1wiXSkge1xuICAgIGZvciAoY29uc3QgZWxlbSBvZiBtYXBSZW5kZXJlci5tYXBEYXRhW3R5cGVdLmRhdGEpIHtcbiAgICAgIG1hcFJlbmRlcmVyLnNjZW5lLnJlbW92ZShlbGVtKTtcbiAgICB9XG4gICAgbWFwUmVuZGVyZXIubWFwRGF0YVt0eXBlXS5kYXRhID0gW107XG4gIH1cblxuICBmb3IgKGNvbnN0IHR5cGUgb2YgW1wicHJvcHNcIl0pIHtcbiAgICBtYXBSZW5kZXJlci5tYXBEYXRhW3R5cGVdLmxvYWRlZCA9IGZhbHNlO1xuICAgIG1hcFJlbmRlcmVyLm1hcERhdGFbdHlwZV0uZW5hYmxlZCA9IGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIG9uTW91c2VNb3ZlKGV2ZW50KSB7XG4gIGNvbnN0IGNhbnZhc0JvdW5kcyA9IG1hcFJlbmRlcmVyLnJlbmRlcmVyLmRvbUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIG1hcFJlbmRlcmVyLm1vdXNlLnggPSAoKGV2ZW50LmNsaWVudFggLSBjYW52YXNCb3VuZHMubGVmdCkgLyAoY2FudmFzQm91bmRzLnJpZ2h0IC0gY2FudmFzQm91bmRzLmxlZnQpKSAqIDIgLSAxO1xuICBtYXBSZW5kZXJlci5tb3VzZS55ID0gLSgoZXZlbnQuY2xpZW50WSAtIGNhbnZhc0JvdW5kcy50b3ApIC8gKGNhbnZhc0JvdW5kcy5ib3R0b20gLSBjYW52YXNCb3VuZHMudG9wKSkgKiAyICsgMTtcbn1cblxuLy8vIEJhc2ljIFRIUkVFIHN0dWZmLCBkb24ndCBtaW5kIGl0XG5mdW5jdGlvbiBzZXR1cFNjZW5lKCkge1xuICBjb25zdCBjYW52YXNXaWR0aCA9IDgwMDtcbiAgY29uc3QgY2FudmFzSGVpZ2h0ID0gODAwO1xuICBjb25zdCBjYW52YXNDbGVhckNvbG9yID0gMHgzNDI5MjA7IC8vIEZvciBoYXBweSByZW5kZXJpbmcsIGFsd2F5cyB1c2UgVmFuIER5a2UgQnJvd24uXG4gIGNvbnN0IGZvdiA9IDYwO1xuICBjb25zdCBhc3BlY3QgPSAxO1xuXG4gIG1hcFJlbmRlcmVyLmNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShmb3YsIGFzcGVjdCwgMC4xLCAxMDAwMDApO1xuICBtYXBSZW5kZXJlci5zY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xuICBtYXBSZW5kZXJlci5tb3VzZSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XG5cbiAgLy8vIFRoaXMgc2NlbmUgaGFzIG9uZSBhbWJpZW50IGxpZ2h0IHNvdXJjZSBhbmQgdGhyZWUgZGlyZWN0aW9uYWwgbGlnaHRzXG4gIGNvbnN0IGFtYmllbnRMaWdodCA9IG5ldyBUSFJFRS5BbWJpZW50TGlnaHQoMHg1NTU1NTUpO1xuICBtYXBSZW5kZXJlci5zY2VuZS5hZGQoYW1iaWVudExpZ2h0KTtcblxuICBjb25zdCBkaXJlY3Rpb25hbExpZ2h0MSA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmLCAwLjgpO1xuICBkaXJlY3Rpb25hbExpZ2h0MS5wb3NpdGlvbi5zZXQoMCwgMCwgMSk7XG4gIG1hcFJlbmRlcmVyLnNjZW5lLmFkZChkaXJlY3Rpb25hbExpZ2h0MSk7XG5cbiAgY29uc3QgZGlyZWN0aW9uYWxMaWdodDIgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZiwgMC44KTtcbiAgZGlyZWN0aW9uYWxMaWdodDIucG9zaXRpb24uc2V0KDEsIDAsIDApO1xuICBtYXBSZW5kZXJlci5zY2VuZS5hZGQoZGlyZWN0aW9uYWxMaWdodDIpO1xuXG4gIGNvbnN0IGRpcmVjdGlvbmFsTGlnaHQzID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoMHhmZmZmZmYsIDAuOCk7XG4gIGRpcmVjdGlvbmFsTGlnaHQzLnBvc2l0aW9uLnNldCgwLCAxLCAwKTtcbiAgbWFwUmVuZGVyZXIuc2NlbmUuYWRkKGRpcmVjdGlvbmFsTGlnaHQzKTtcblxuICAvLy8gU3RhbmRhcmQgVEhSRUUgcmVuZGVyZXIgd2l0aCBBQVxuICBtYXBSZW5kZXJlci5yZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHtcbiAgICBhbnRpYWxpYXNpbmc6IHRydWUsXG4gICAgbG9nYXJpdGhtaWNEZXB0aEJ1ZmZlcjogdHJ1ZSxcbiAgfSk7XG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobWFwUmVuZGVyZXIucmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gIG1hcFJlbmRlcmVyLnJlbmRlcmVyLnNldFNpemUoY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodCk7XG4gIG1hcFJlbmRlcmVyLnJlbmRlcmVyLnNldENsZWFyQ29sb3IoY2FudmFzQ2xlYXJDb2xvcik7XG5cbiAgc2V0dXBDb250cm9sbGVyKCk7XG5cbiAgLy8vIE5vdGU6IGNvbnN0YW50IGNvbnRpbm91cyByZW5kZXJpbmcgZnJvbSBwYWdlIGxvYWRcbiAgcmVuZGVyKCk7XG59XG5cbmZ1bmN0aW9uIHNldHVwQ29udHJvbGxlcigpIHtcbiAgaWYgKCFtYXBSZW5kZXJlci5jb250cm9scykge1xuICAgIGNvbnN0IGNvbnRyb2xzID0gbmV3IFRIUkVFLk9yYml0Q29udHJvbHMobWFwUmVuZGVyZXIuY2FtZXJhLCBtYXBSZW5kZXJlci5yZW5kZXJlci5kb21FbGVtZW50KTtcbiAgICBjb250cm9scy5lbmFibGVab29tID0gdHJ1ZTtcbiAgICBtYXBSZW5kZXJlci5jb250cm9scyA9IGNvbnRyb2xzO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO1xuICBtYXBSZW5kZXJlci5yZW5kZXJlci5yZW5kZXIobWFwUmVuZGVyZXIuc2NlbmUsIG1hcFJlbmRlcmVyLmNhbWVyYSk7XG59XG4iXX0="}