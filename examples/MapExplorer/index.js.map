{"version":3,"sources":["MapExplorer/node_modules/browser-pack/_prelude.js","MapExplorer/src/MapExplorer/index.js","MapExplorer/src/MapExplorer/renderer.js"],"names":[],"mappings":"AAAA;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC/JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","const AppRenderer = require(\"./renderer\");\n\nconst stats = new Stats();\n$(\"body\").append(stats.domElement);\n$(stats.domElement).hide();\nstats.toggle = () => $(stats.domElement).toggle();\nglobal.stats = stats;\n\n/// Extend Original Logger\nconst myLogger = {\n  lastMessageType: null,\n  log: function () {\n    const htmlOutput = $(\"#log\");\n    const str = Array.prototype.slice.call(arguments, 1).join(\" \");\n    if (arguments[1] === myLogger.lastMessageType) {\n      $(\"#log p:last-of-type\")[0].innerHTML = str;\n    } else {\n      htmlOutput.append($(\"<p>-------------</p>\"));\n      htmlOutput.append($(\"<p>\" + str + \"</p>\"));\n    }\n    htmlOutput[0].scrollTop = htmlOutput[0].scrollHeight;\n    myLogger.lastMessageType = arguments[1];\n  },\n};\n\nconst mapRenderer = new AppRenderer(myLogger);\n\n$(document).ready(function () {\n  /// Build TREE scene\n  mapRenderer.init();\n\n  /// Handle file pick\n  $(\"#filePicker\").change(function (evt) {\n    const file = evt.target.files[0];\n    // Disable button\n    $(\"#filePicker\").prop(\"disabled\", true);\n\n    mapRenderer.createLocalReader(file, onReaderCreated);\n  });\n\n  /// Handle button click\n  $(\"#loadMapBtn\").click(onLoadMapClick);\n});\n\n/// Callback for when the LocalReader has finished setting up!\nasync function onReaderCreated() {\n  const mapFileList = await mapRenderer.getMapList();\n  const categoryList = mapFileList.reduce((list, map) => {\n    if (!list.includes(map.category)) {\n      list.push(map.category);\n    }\n    return list;\n  }, []);\n  for (const category of categoryList) {\n    const opt = document.createElement(\"option\");\n    opt.disabled = true;\n    opt.innerHTML = category;\n    $(\"#fileMapSelect\").append(opt);\n\n    for (const map of mapFileList.filter((m) => m.category === category)) {\n      const opt = document.createElement(\"option\");\n      opt.value = map.baseId;\n      opt.innerHTML = map.name; // whatever property it has\n      if (map.baseId === 294938) {\n        opt.setAttribute(\"selected\", true);\n      }\n\n      // then append it to the select element\n      $(\"#fileMapSelect\").append(opt);\n    }\n  }\n\n  $(\"#fileMapSelect\").removeAttr(\"disabled\");\n  $(\"#loadMapBtn\").removeAttr(\"disabled\");\n}\n\n/// The insterresting part!\nfunction onLoadMapClick() {\n  $(\"#loadMapBtn\").prop(\"disabled\", true);\n  $(\"#loadCollBtn\").click(loadCollModels);\n  $(\"#loadCollBtn\").removeAttr(\"disabled\");\n  $(\"#loadPropsBtn\").click(loadPropModels);\n  $(\"#loadPropsBtn\").removeAttr(\"disabled\");\n  $(\"#loadZoneBtn\").click(loadZoneModels);\n  $(\"#loadZoneBtn\").removeAttr(\"disabled\");\n  $(\"#mvntSpeedRange\").removeAttr(\"disabled\");\n  $(\"#mvntSpeedRange\").change((event) => mapRenderer.setMovementSpeed(event.target.valueAsNumber));\n  $(\"#fogRange\").removeAttr(\"disabled\");\n  $(\"#fogRange\").change((event) => {\n    mapRenderer.setFog(event.target.valueAsNumber);\n  });\n  $(\"#controllerReset\").click(() => mapRenderer.setupController());\n  $(\"#controllerReset\").removeAttr(\"disabled\");\n\n  $(\"canvas\").on(\"wheel\", onMouseWheel);\n\n  mapRenderer.loadMap($(\"#fileMapSelect\").val());\n\n  $(\"#fileMapSelect\").prop(\"disabled\", true);\n\n  /// Setup the logger (hacky way because very verbose)\n  T3D.Logger.logFunctions[T3D.Logger.TYPE_PROGRESS] = function () {\n    myLogger.log(arguments[0], arguments[0], arguments[1]);\n    console.log(arguments[0], arguments[1]);\n  };\n}\n\n/// Action when the load zone props button is clicked\nfunction loadZoneModels() {\n  const buttonId = \"#loadZoneBtn\";\n  if (!mapRenderer.isZoneModelsLoaded()) {\n    mapRenderer.loadZoneModels(function () {\n      mapRenderer.toggleZoneModels();\n      $(buttonId)[0].innerHTML = $(buttonId)[0].innerHTML.replace(\"Load\", \"Unload\");\n    });\n  } else {\n    mapRenderer.toggleZoneModels();\n    $(buttonId)[0].innerHTML = $(buttonId)[0].innerHTML.replace(\"Unload\", \"Load\");\n  }\n}\n\n/// Action when the load props button is clicked\nfunction loadPropModels() {\n  const buttonId = \"#loadPropsBtn\";\n  if (!mapRenderer.isPropModelsLoaded()) {\n    mapRenderer.loadPropModels(function () {\n      mapRenderer.togglePropModels();\n      $(buttonId)[0].innerHTML = $(buttonId)[0].innerHTML.replace(\"Load\", \"Unload\");\n    });\n  } else {\n    mapRenderer.togglePropModels();\n    $(buttonId)[0].innerHTML = $(buttonId)[0].innerHTML.replace(\"Unload\", \"Load\");\n  }\n}\n\n/// Action when the load collisions button is clicked\nfunction loadCollModels() {\n  const buttonId = \"#loadCollBtn\";\n  if (!mapRenderer.isCollModelsLoaded()) {\n    mapRenderer.loadCollModels(function () {\n      mapRenderer.toggleCollModels();\n      $(buttonId)[0].innerHTML = $(buttonId)[0].innerHTML.replace(\"Load\", \"Unload\");\n    });\n  } else {\n    mapRenderer.toggleCollModels();\n    $(buttonId)[0].innerHTML = $(buttonId)[0].innerHTML.replace(\"Unload\", \"Load\");\n  }\n}\n\nfunction onMouseWheel(event) {\n  let newSpeed;\n  if (event.originalEvent.deltaY < 0) {\n    newSpeed = Math.min(mapRenderer.getMovementSpeed() + 100, 10000);\n  } else {\n    newSpeed = Math.max(mapRenderer.getMovementSpeed() - 100, 500);\n  }\n  mapRenderer.setMovementSpeed(newSpeed);\n  $(\"#mvntSpeedRange\").val(newSpeed);\n}\n","class AppRenderer {\n  constructor(logger) {\n    this.logger = logger;\n\n    /// This example is very inspired by the ModelRenderer example but updated\n    /// using the latest version of the API. This global object for the app contains\n    /// all the important data.\n\n    /// All renderers must have access to a LocalReader.\n    /// The LocalReader is the object that allows us\n    /// to read from the .dat\n    this.localReader = null;\n\n    /// The context is an object all the renderer outputs their data to\n    this.context = null;\n\n    /// THREE js objects\n    this.scene = null;\n    this.skyScene = null;\n    this.camera = null;\n    this.skyCamera = null;\n    this.renderer = null;\n    this.clock = null;\n    this.mouse = null;\n    this.controls = null;\n    this.controlsEnabled = false;\n\n    /// Data:\n    this._cleanMapData();\n  }\n\n  /**\n   * Public methods\n   */\n  createLocalReader(file, callback) {\n    this.localReader = T3D.getLocalReader(file, callback, \"../static/t3dworker.js\", this.logger);\n  }\n\n  getMapList() {\n    return this.localReader.getMapList();\n  }\n\n  // Setup schene\n  init() {\n    const canvasWidth = window.innerWidth;\n    const canvasHeight = window.innerHeight;\n    const canvasClearColor = 0x342920; // For happy rendering, always use Van Dyke Brown.\n    const fov = 60;\n    const aspect = canvasWidth / canvasHeight;\n    const fogDistance = Number($(\"#fogRange\").val());\n\n    this.camera = new THREE.PerspectiveCamera(fov, aspect, 0.1, 100000);\n    this.skyCamera = new THREE.PerspectiveCamera(fov, aspect, 0.1, 1000000);\n    this.scene = new THREE.Scene();\n    this.skyScene = new THREE.Scene();\n    this.mouse = new THREE.Vector2();\n\n    this.clock = new THREE.Clock();\n    /// This scene has one ambient light source and three directional lights\n    const ambientLight = new THREE.AmbientLight(0x555555);\n    this.scene.add(ambientLight);\n\n    const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.5);\n    directionalLight1.position.set(0, 0, 1);\n    this.scene.add(directionalLight1);\n\n    const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.5);\n    directionalLight2.position.set(1, 0, 0);\n    this.scene.add(directionalLight2);\n\n    const directionalLight3 = new THREE.DirectionalLight(0xffffff, 0.5);\n    directionalLight3.position.set(0, 1, 0);\n    this.scene.add(directionalLight3);\n\n    // Fog\n    this.scene.fog = new THREE.Fog(0xffffff, fogDistance, fogDistance + 1000);\n    this.camera.far = fogDistance + 1000;\n    this.camera.updateProjectionMatrix();\n\n    /// Standard THREE renderer with AA\n    this.renderer = new THREE.WebGLRenderer({\n      antialiasing: true,\n      logarithmicDepthBuffer: true,\n      sortObjects: false,\n      stencil: false,\n      premultipliedAlpha: false,\n    });\n    this.renderer.autoClear = false;\n    document.body.appendChild(this.renderer.domElement);\n    this.renderer.setSize(canvasWidth, canvasHeight);\n    this.renderer.setClearColor(canvasClearColor);\n\n    window.addEventListener(\"resize\", () => {\n      const SCREEN_HEIGHT = window.innerHeight;\n      const SCREEN_WIDTH = window.innerWidth;\n\n      this.camera.aspect = SCREEN_WIDTH / SCREEN_HEIGHT;\n      this.camera.updateProjectionMatrix();\n      this.skyCamera.aspect = SCREEN_WIDTH / SCREEN_HEIGHT;\n      this.skyCamera.updateProjectionMatrix();\n\n      this.renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);\n    });\n\n    this.setupController();\n\n    /// Note: constant continous rendering from page load\n    this._render();\n  }\n\n  isCollModelsLoaded() {\n    this.mapData.collision.loaded;\n  }\n\n  isPropModelsLoaded() {\n    return this.mapData.props.loaded;\n  }\n\n  isZoneModelsLoaded() {\n    return this.mapData.zone.loaded;\n  }\n\n  loadMap(mapId) {\n    // Clean previous render states\n    this._cleanMapData();\n    this.mapData.id = mapId;\n\n    /// Renderer settings (see the documentation of each Renderer for details)\n    const renderers = [\n      {\n        renderClass: T3D.EnvironmentRenderer,\n        settings: {},\n      },\n      {\n        renderClass: T3D.TerrainRenderer,\n        settings: {},\n      },\n    ];\n    /// Load for the first time the renderer and spawn the context\n    T3D.renderMapContentsAsync(\n      this.localReader,\n      this.mapData.id,\n      renderers,\n      (context) => {\n        this._onRendererDone(context);\n      },\n      this.logger\n    );\n\n    // Cache mapFile for later use\n    if (parseInt(this.mapData.id)) {\n      this.localReader.loadFile(this.mapData.id, (arrayBuffer) => {\n        const ds = new DataStream(arrayBuffer, 0, DataStream.LITTLE_ENDIAN);\n        this.mapData.mapFile = new T3D.GW2File(ds, 0);\n      });\n    }\n  }\n\n  loadZoneModels(callback) {\n    this._loadMeshes(T3D.ZoneRenderer, this.mapData.zone, callback);\n  }\n\n  loadPropModels(callback) {\n    this._loadMeshes(T3D.PropertiesRenderer, this.mapData.props, callback);\n  }\n\n  loadCollModels(callback) {\n    this._loadMeshes(T3D.HavokRenderer, this.mapData.collision, callback);\n  }\n\n  setFog(fogDistance) {\n    if (this.scene && this.scene.fog) {\n      this.scene.fog.near = fogDistance;\n      this.scene.fog.far = fogDistance + 1000;\n    }\n    if (this.camera) {\n      this.camera.far = fogDistance + 1000;\n      this.camera.updateProjectionMatrix();\n    }\n  }\n\n  setMovementSpeed(speed) {\n    if (this.controls) {\n      this.controls.movementSpeed = speed;\n    }\n  }\n\n  getMovementSpeed() {\n    if (this.controls) {\n      return this.controls.movementSpeed;\n    }\n\n    return 0;\n  }\n\n  toggleZoneModels() {\n    return this._toggleModels(\"zone\");\n  }\n\n  togglePropModels() {\n    return this._toggleModels(\"props\");\n  }\n\n  toggleCollModels() {\n    return this._toggleModels(\"collision\");\n  }\n\n  /**\n   * Private methods\n   */\n\n  _cleanMapData() {\n    this.mapData = {\n      id: null,\n      mapFile: null,\n      terrain: {\n        data: [],\n      },\n      collision: {\n        enabled: false,\n        loaded: false,\n        data: [],\n      },\n      props: {\n        enabled: false,\n        loaded: false,\n        data: [],\n      },\n      zone: {\n        enabled: false,\n        loaded: false,\n        data: [],\n      },\n    };\n  }\n\n  /// Wipes out the data\n  _cleanScene() {\n    for (const type of [\"terrain\", \"props\", \"zone\", \"collision\"]) {\n      for (const elem of this.mapData[type].data) {\n        this.scene.remove(elem);\n      }\n      this.mapData[type].data = [];\n    }\n\n    for (const type of [\"props\", \"zone\", \"collision\"]) {\n      this.mapData[type].loaded = false;\n      this.mapData[type].enabled = false;\n    }\n  }\n\n  /// Run a renderer manually and populates the data object\n  _loadMeshes(rendererClass, outRendererData, callback) {\n    T3D.runRenderer(\n      rendererClass,\n      this.localReader,\n      { visible: true, mapFile: this.mapData.mapFile, showUnmaterialized: false },\n      this.context,\n      () => {\n        outRendererData.data = T3D.getContextValue(this.context, rendererClass, \"meshes\");\n        outRendererData.loaded = true;\n        callback();\n      }\n    );\n  }\n\n  setupController() {\n    if (this.controls) {\n      this.controls.dispose();\n    }\n\n    const controls = new THREE.FlyControls(this.camera, this.renderer.domElement);\n\n    controls.movementSpeed = Number($(\"#mvntSpeedRange\").val()) | 1000;\n    controls.domElement = this.renderer.domElement;\n    controls.rollSpeed = Math.PI / 6;\n    controls.autoForward = false;\n    controls.dragToLook = true;\n    this.controls = controls;\n  }\n\n  _render() {\n    global.stats.update();\n    window.requestAnimationFrame(() => this._render());\n\n    const delta = this.clock.getDelta();\n    this.controls.update(delta);\n\n    // Render first skyCamera\n    this.skyCamera.quaternion.copy(this.camera.quaternion);\n    this.renderer.clear(this.renderer.getClearColor());\n    this.renderer.render(this.skyScene, this.skyCamera);\n\n    this.renderer.render(this.scene, this.camera);\n  }\n\n  _toggleModels(meshType) {\n    if (this.mapData[meshType].enabled) {\n      for (const elem of this.mapData[meshType].data) {\n        this.scene.remove(elem);\n      }\n      this.mapData[meshType].enabled = false;\n      return false;\n    } else {\n      for (const elem of this.mapData[meshType].data) {\n        this.scene.add(elem);\n      }\n      this.mapData[meshType].enabled = true;\n      return true;\n    }\n  }\n\n  /// Runs when the ModelRenderer is finished\n  _onRendererDone(context) {\n    this._cleanScene();\n\n    /// Populate our context with the context returned\n    this.context = context;\n\n    /// Take all the terrain tiles generated by the TerrainRenderer and add them to the scene\n    for (const elem of T3D.getContextValue(context, T3D.TerrainRenderer, \"terrainTiles\")) {\n      this.scene.add(elem);\n      this.mapData.terrain.data.push(elem);\n    }\n\n    /// Skybox\n    const skyBox = T3D.getContextValue(context, T3D.EnvironmentRenderer, \"skyBox\");\n    this.skyScene.add(skyBox);\n    const hazeColor = T3D.getContextValue(context, T3D.EnvironmentRenderer, \"hazeColor\");\n    if (hazeColor) {\n      this.renderer.setClearColor(new THREE.Color(hazeColor[2] / 255, hazeColor[1] / 255, hazeColor[0] / 255));\n    }\n\n    /// Add the water level to the scene\n    const water = T3D.getContextValue(context, T3D.TerrainRenderer, \"water\");\n    this.scene.add(water);\n    this.mapData.terrain.data.push(water);\n\n    /// Move the camera initial place depending on the map bounds\n    const bounds = T3D.getContextValue(context, T3D.TerrainRenderer, \"bounds\");\n    this.camera.position.x = 0;\n    this.camera.position.y = bounds ? bounds.y2 : 0;\n    this.camera.position.z = 0;\n    this.camera.rotation.x = (-90 * Math.PI) / 180;\n  }\n}\n\nmodule.exports = AppRenderer;\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvTWFwRXhwbG9yZXIvaW5kZXguanMiLCJzcmMvTWFwRXhwbG9yZXIvcmVuZGVyZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDL0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiY29uc3QgQXBwUmVuZGVyZXIgPSByZXF1aXJlKFwiLi9yZW5kZXJlclwiKTtcblxuY29uc3Qgc3RhdHMgPSBuZXcgU3RhdHMoKTtcbiQoXCJib2R5XCIpLmFwcGVuZChzdGF0cy5kb21FbGVtZW50KTtcbiQoc3RhdHMuZG9tRWxlbWVudCkuaGlkZSgpO1xuc3RhdHMudG9nZ2xlID0gKCkgPT4gJChzdGF0cy5kb21FbGVtZW50KS50b2dnbGUoKTtcbmdsb2JhbC5zdGF0cyA9IHN0YXRzO1xuXG4vLy8gRXh0ZW5kIE9yaWdpbmFsIExvZ2dlclxuY29uc3QgbXlMb2dnZXIgPSB7XG4gIGxhc3RNZXNzYWdlVHlwZTogbnVsbCxcbiAgbG9nOiBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgaHRtbE91dHB1dCA9ICQoXCIjbG9nXCIpO1xuICAgIGNvbnN0IHN0ciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkuam9pbihcIiBcIik7XG4gICAgaWYgKGFyZ3VtZW50c1sxXSA9PT0gbXlMb2dnZXIubGFzdE1lc3NhZ2VUeXBlKSB7XG4gICAgICAkKFwiI2xvZyBwOmxhc3Qtb2YtdHlwZVwiKVswXS5pbm5lckhUTUwgPSBzdHI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGh0bWxPdXRwdXQuYXBwZW5kKCQoXCI8cD4tLS0tLS0tLS0tLS0tPC9wPlwiKSk7XG4gICAgICBodG1sT3V0cHV0LmFwcGVuZCgkKFwiPHA+XCIgKyBzdHIgKyBcIjwvcD5cIikpO1xuICAgIH1cbiAgICBodG1sT3V0cHV0WzBdLnNjcm9sbFRvcCA9IGh0bWxPdXRwdXRbMF0uc2Nyb2xsSGVpZ2h0O1xuICAgIG15TG9nZ2VyLmxhc3RNZXNzYWdlVHlwZSA9IGFyZ3VtZW50c1sxXTtcbiAgfSxcbn07XG5cbmNvbnN0IG1hcFJlbmRlcmVyID0gbmV3IEFwcFJlbmRlcmVyKG15TG9nZ2VyKTtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAvLy8gQnVpbGQgVFJFRSBzY2VuZVxuICBtYXBSZW5kZXJlci5pbml0KCk7XG5cbiAgLy8vIEhhbmRsZSBmaWxlIHBpY2tcbiAgJChcIiNmaWxlUGlja2VyXCIpLmNoYW5nZShmdW5jdGlvbiAoZXZ0KSB7XG4gICAgY29uc3QgZmlsZSA9IGV2dC50YXJnZXQuZmlsZXNbMF07XG4gICAgLy8gRGlzYWJsZSBidXR0b25cbiAgICAkKFwiI2ZpbGVQaWNrZXJcIikucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xuXG4gICAgbWFwUmVuZGVyZXIuY3JlYXRlTG9jYWxSZWFkZXIoZmlsZSwgb25SZWFkZXJDcmVhdGVkKTtcbiAgfSk7XG5cbiAgLy8vIEhhbmRsZSBidXR0b24gY2xpY2tcbiAgJChcIiNsb2FkTWFwQnRuXCIpLmNsaWNrKG9uTG9hZE1hcENsaWNrKTtcbn0pO1xuXG4vLy8gQ2FsbGJhY2sgZm9yIHdoZW4gdGhlIExvY2FsUmVhZGVyIGhhcyBmaW5pc2hlZCBzZXR0aW5nIHVwIVxuYXN5bmMgZnVuY3Rpb24gb25SZWFkZXJDcmVhdGVkKCkge1xuICBjb25zdCBtYXBGaWxlTGlzdCA9IGF3YWl0IG1hcFJlbmRlcmVyLmdldE1hcExpc3QoKTtcbiAgY29uc3QgY2F0ZWdvcnlMaXN0ID0gbWFwRmlsZUxpc3QucmVkdWNlKChsaXN0LCBtYXApID0+IHtcbiAgICBpZiAoIWxpc3QuaW5jbHVkZXMobWFwLmNhdGVnb3J5KSkge1xuICAgICAgbGlzdC5wdXNoKG1hcC5jYXRlZ29yeSk7XG4gICAgfVxuICAgIHJldHVybiBsaXN0O1xuICB9LCBbXSk7XG4gIGZvciAoY29uc3QgY2F0ZWdvcnkgb2YgY2F0ZWdvcnlMaXN0KSB7XG4gICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICBvcHQuZGlzYWJsZWQgPSB0cnVlO1xuICAgIG9wdC5pbm5lckhUTUwgPSBjYXRlZ29yeTtcbiAgICAkKFwiI2ZpbGVNYXBTZWxlY3RcIikuYXBwZW5kKG9wdCk7XG5cbiAgICBmb3IgKGNvbnN0IG1hcCBvZiBtYXBGaWxlTGlzdC5maWx0ZXIoKG0pID0+IG0uY2F0ZWdvcnkgPT09IGNhdGVnb3J5KSkge1xuICAgICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICAgIG9wdC52YWx1ZSA9IG1hcC5iYXNlSWQ7XG4gICAgICBvcHQuaW5uZXJIVE1MID0gbWFwLm5hbWU7IC8vIHdoYXRldmVyIHByb3BlcnR5IGl0IGhhc1xuICAgICAgaWYgKG1hcC5iYXNlSWQgPT09IDI5NDkzOCkge1xuICAgICAgICBvcHQuc2V0QXR0cmlidXRlKFwic2VsZWN0ZWRcIiwgdHJ1ZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIHRoZW4gYXBwZW5kIGl0IHRvIHRoZSBzZWxlY3QgZWxlbWVudFxuICAgICAgJChcIiNmaWxlTWFwU2VsZWN0XCIpLmFwcGVuZChvcHQpO1xuICAgIH1cbiAgfVxuXG4gICQoXCIjZmlsZU1hcFNlbGVjdFwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG4gICQoXCIjbG9hZE1hcEJ0blwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG59XG5cbi8vLyBUaGUgaW5zdGVycmVzdGluZyBwYXJ0IVxuZnVuY3Rpb24gb25Mb2FkTWFwQ2xpY2soKSB7XG4gICQoXCIjbG9hZE1hcEJ0blwiKS5wcm9wKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICQoXCIjbG9hZENvbGxCdG5cIikuY2xpY2sobG9hZENvbGxNb2RlbHMpO1xuICAkKFwiI2xvYWRDb2xsQnRuXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcbiAgJChcIiNsb2FkUHJvcHNCdG5cIikuY2xpY2sobG9hZFByb3BNb2RlbHMpO1xuICAkKFwiI2xvYWRQcm9wc0J0blwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG4gICQoXCIjbG9hZFpvbmVCdG5cIikuY2xpY2sobG9hZFpvbmVNb2RlbHMpO1xuICAkKFwiI2xvYWRab25lQnRuXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcbiAgJChcIiNtdm50U3BlZWRSYW5nZVwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG4gICQoXCIjbXZudFNwZWVkUmFuZ2VcIikuY2hhbmdlKChldmVudCkgPT4gbWFwUmVuZGVyZXIuc2V0TW92ZW1lbnRTcGVlZChldmVudC50YXJnZXQudmFsdWVBc051bWJlcikpO1xuICAkKFwiI2ZvZ1JhbmdlXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcbiAgJChcIiNmb2dSYW5nZVwiKS5jaGFuZ2UoKGV2ZW50KSA9PiB7XG4gICAgbWFwUmVuZGVyZXIuc2V0Rm9nKGV2ZW50LnRhcmdldC52YWx1ZUFzTnVtYmVyKTtcbiAgfSk7XG4gICQoXCIjY29udHJvbGxlclJlc2V0XCIpLmNsaWNrKCgpID0+IG1hcFJlbmRlcmVyLnNldHVwQ29udHJvbGxlcigpKTtcbiAgJChcIiNjb250cm9sbGVyUmVzZXRcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xuXG4gICQoXCJjYW52YXNcIikub24oXCJ3aGVlbFwiLCBvbk1vdXNlV2hlZWwpO1xuXG4gIG1hcFJlbmRlcmVyLmxvYWRNYXAoJChcIiNmaWxlTWFwU2VsZWN0XCIpLnZhbCgpKTtcblxuICAkKFwiI2ZpbGVNYXBTZWxlY3RcIikucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xuXG4gIC8vLyBTZXR1cCB0aGUgbG9nZ2VyIChoYWNreSB3YXkgYmVjYXVzZSB2ZXJ5IHZlcmJvc2UpXG4gIFQzRC5Mb2dnZXIubG9nRnVuY3Rpb25zW1QzRC5Mb2dnZXIuVFlQRV9QUk9HUkVTU10gPSBmdW5jdGlvbiAoKSB7XG4gICAgbXlMb2dnZXIubG9nKGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0pO1xuICAgIGNvbnNvbGUubG9nKGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdKTtcbiAgfTtcbn1cblxuLy8vIEFjdGlvbiB3aGVuIHRoZSBsb2FkIHpvbmUgcHJvcHMgYnV0dG9uIGlzIGNsaWNrZWRcbmZ1bmN0aW9uIGxvYWRab25lTW9kZWxzKCkge1xuICBjb25zdCBidXR0b25JZCA9IFwiI2xvYWRab25lQnRuXCI7XG4gIGlmICghbWFwUmVuZGVyZXIuaXNab25lTW9kZWxzTG9hZGVkKCkpIHtcbiAgICBtYXBSZW5kZXJlci5sb2FkWm9uZU1vZGVscyhmdW5jdGlvbiAoKSB7XG4gICAgICBtYXBSZW5kZXJlci50b2dnbGVab25lTW9kZWxzKCk7XG4gICAgICAkKGJ1dHRvbklkKVswXS5pbm5lckhUTUwgPSAkKGJ1dHRvbklkKVswXS5pbm5lckhUTUwucmVwbGFjZShcIkxvYWRcIiwgXCJVbmxvYWRcIik7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgbWFwUmVuZGVyZXIudG9nZ2xlWm9uZU1vZGVscygpO1xuICAgICQoYnV0dG9uSWQpWzBdLmlubmVySFRNTCA9ICQoYnV0dG9uSWQpWzBdLmlubmVySFRNTC5yZXBsYWNlKFwiVW5sb2FkXCIsIFwiTG9hZFwiKTtcbiAgfVxufVxuXG4vLy8gQWN0aW9uIHdoZW4gdGhlIGxvYWQgcHJvcHMgYnV0dG9uIGlzIGNsaWNrZWRcbmZ1bmN0aW9uIGxvYWRQcm9wTW9kZWxzKCkge1xuICBjb25zdCBidXR0b25JZCA9IFwiI2xvYWRQcm9wc0J0blwiO1xuICBpZiAoIW1hcFJlbmRlcmVyLmlzUHJvcE1vZGVsc0xvYWRlZCgpKSB7XG4gICAgbWFwUmVuZGVyZXIubG9hZFByb3BNb2RlbHMoZnVuY3Rpb24gKCkge1xuICAgICAgbWFwUmVuZGVyZXIudG9nZ2xlUHJvcE1vZGVscygpO1xuICAgICAgJChidXR0b25JZClbMF0uaW5uZXJIVE1MID0gJChidXR0b25JZClbMF0uaW5uZXJIVE1MLnJlcGxhY2UoXCJMb2FkXCIsIFwiVW5sb2FkXCIpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIG1hcFJlbmRlcmVyLnRvZ2dsZVByb3BNb2RlbHMoKTtcbiAgICAkKGJ1dHRvbklkKVswXS5pbm5lckhUTUwgPSAkKGJ1dHRvbklkKVswXS5pbm5lckhUTUwucmVwbGFjZShcIlVubG9hZFwiLCBcIkxvYWRcIik7XG4gIH1cbn1cblxuLy8vIEFjdGlvbiB3aGVuIHRoZSBsb2FkIGNvbGxpc2lvbnMgYnV0dG9uIGlzIGNsaWNrZWRcbmZ1bmN0aW9uIGxvYWRDb2xsTW9kZWxzKCkge1xuICBjb25zdCBidXR0b25JZCA9IFwiI2xvYWRDb2xsQnRuXCI7XG4gIGlmICghbWFwUmVuZGVyZXIuaXNDb2xsTW9kZWxzTG9hZGVkKCkpIHtcbiAgICBtYXBSZW5kZXJlci5sb2FkQ29sbE1vZGVscyhmdW5jdGlvbiAoKSB7XG4gICAgICBtYXBSZW5kZXJlci50b2dnbGVDb2xsTW9kZWxzKCk7XG4gICAgICAkKGJ1dHRvbklkKVswXS5pbm5lckhUTUwgPSAkKGJ1dHRvbklkKVswXS5pbm5lckhUTUwucmVwbGFjZShcIkxvYWRcIiwgXCJVbmxvYWRcIik7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgbWFwUmVuZGVyZXIudG9nZ2xlQ29sbE1vZGVscygpO1xuICAgICQoYnV0dG9uSWQpWzBdLmlubmVySFRNTCA9ICQoYnV0dG9uSWQpWzBdLmlubmVySFRNTC5yZXBsYWNlKFwiVW5sb2FkXCIsIFwiTG9hZFwiKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBvbk1vdXNlV2hlZWwoZXZlbnQpIHtcbiAgbGV0IG5ld1NwZWVkO1xuICBpZiAoZXZlbnQub3JpZ2luYWxFdmVudC5kZWx0YVkgPCAwKSB7XG4gICAgbmV3U3BlZWQgPSBNYXRoLm1pbihtYXBSZW5kZXJlci5nZXRNb3ZlbWVudFNwZWVkKCkgKyAxMDAsIDEwMDAwKTtcbiAgfSBlbHNlIHtcbiAgICBuZXdTcGVlZCA9IE1hdGgubWF4KG1hcFJlbmRlcmVyLmdldE1vdmVtZW50U3BlZWQoKSAtIDEwMCwgNTAwKTtcbiAgfVxuICBtYXBSZW5kZXJlci5zZXRNb3ZlbWVudFNwZWVkKG5ld1NwZWVkKTtcbiAgJChcIiNtdm50U3BlZWRSYW5nZVwiKS52YWwobmV3U3BlZWQpO1xufVxuIiwiY2xhc3MgQXBwUmVuZGVyZXIge1xuICBjb25zdHJ1Y3Rvcihsb2dnZXIpIHtcbiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcjtcblxuICAgIC8vLyBUaGlzIGV4YW1wbGUgaXMgdmVyeSBpbnNwaXJlZCBieSB0aGUgTW9kZWxSZW5kZXJlciBleGFtcGxlIGJ1dCB1cGRhdGVkXG4gICAgLy8vIHVzaW5nIHRoZSBsYXRlc3QgdmVyc2lvbiBvZiB0aGUgQVBJLiBUaGlzIGdsb2JhbCBvYmplY3QgZm9yIHRoZSBhcHAgY29udGFpbnNcbiAgICAvLy8gYWxsIHRoZSBpbXBvcnRhbnQgZGF0YS5cblxuICAgIC8vLyBBbGwgcmVuZGVyZXJzIG11c3QgaGF2ZSBhY2Nlc3MgdG8gYSBMb2NhbFJlYWRlci5cbiAgICAvLy8gVGhlIExvY2FsUmVhZGVyIGlzIHRoZSBvYmplY3QgdGhhdCBhbGxvd3MgdXNcbiAgICAvLy8gdG8gcmVhZCBmcm9tIHRoZSAuZGF0XG4gICAgdGhpcy5sb2NhbFJlYWRlciA9IG51bGw7XG5cbiAgICAvLy8gVGhlIGNvbnRleHQgaXMgYW4gb2JqZWN0IGFsbCB0aGUgcmVuZGVyZXIgb3V0cHV0cyB0aGVpciBkYXRhIHRvXG4gICAgdGhpcy5jb250ZXh0ID0gbnVsbDtcblxuICAgIC8vLyBUSFJFRSBqcyBvYmplY3RzXG4gICAgdGhpcy5zY2VuZSA9IG51bGw7XG4gICAgdGhpcy5za3lTY2VuZSA9IG51bGw7XG4gICAgdGhpcy5jYW1lcmEgPSBudWxsO1xuICAgIHRoaXMuc2t5Q2FtZXJhID0gbnVsbDtcbiAgICB0aGlzLnJlbmRlcmVyID0gbnVsbDtcbiAgICB0aGlzLmNsb2NrID0gbnVsbDtcbiAgICB0aGlzLm1vdXNlID0gbnVsbDtcbiAgICB0aGlzLmNvbnRyb2xzID0gbnVsbDtcbiAgICB0aGlzLmNvbnRyb2xzRW5hYmxlZCA9IGZhbHNlO1xuXG4gICAgLy8vIERhdGE6XG4gICAgdGhpcy5fY2xlYW5NYXBEYXRhKCk7XG4gIH1cblxuICAvKipcbiAgICogUHVibGljIG1ldGhvZHNcbiAgICovXG4gIGNyZWF0ZUxvY2FsUmVhZGVyKGZpbGUsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5sb2NhbFJlYWRlciA9IFQzRC5nZXRMb2NhbFJlYWRlcihmaWxlLCBjYWxsYmFjaywgXCIuLi9zdGF0aWMvdDNkd29ya2VyLmpzXCIsIHRoaXMubG9nZ2VyKTtcbiAgfVxuXG4gIGdldE1hcExpc3QoKSB7XG4gICAgcmV0dXJuIHRoaXMubG9jYWxSZWFkZXIuZ2V0TWFwTGlzdCgpO1xuICB9XG5cbiAgLy8gU2V0dXAgc2NoZW5lXG4gIGluaXQoKSB7XG4gICAgY29uc3QgY2FudmFzV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICBjb25zdCBjYW52YXNIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgY29uc3QgY2FudmFzQ2xlYXJDb2xvciA9IDB4MzQyOTIwOyAvLyBGb3IgaGFwcHkgcmVuZGVyaW5nLCBhbHdheXMgdXNlIFZhbiBEeWtlIEJyb3duLlxuICAgIGNvbnN0IGZvdiA9IDYwO1xuICAgIGNvbnN0IGFzcGVjdCA9IGNhbnZhc1dpZHRoIC8gY2FudmFzSGVpZ2h0O1xuICAgIGNvbnN0IGZvZ0Rpc3RhbmNlID0gTnVtYmVyKCQoXCIjZm9nUmFuZ2VcIikudmFsKCkpO1xuXG4gICAgdGhpcy5jYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoZm92LCBhc3BlY3QsIDAuMSwgMTAwMDAwKTtcbiAgICB0aGlzLnNreUNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShmb3YsIGFzcGVjdCwgMC4xLCAxMDAwMDAwKTtcbiAgICB0aGlzLnNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG4gICAgdGhpcy5za3lTY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xuICAgIHRoaXMubW91c2UgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xuXG4gICAgdGhpcy5jbG9jayA9IG5ldyBUSFJFRS5DbG9jaygpO1xuICAgIC8vLyBUaGlzIHNjZW5lIGhhcyBvbmUgYW1iaWVudCBsaWdodCBzb3VyY2UgYW5kIHRocmVlIGRpcmVjdGlvbmFsIGxpZ2h0c1xuICAgIGNvbnN0IGFtYmllbnRMaWdodCA9IG5ldyBUSFJFRS5BbWJpZW50TGlnaHQoMHg1NTU1NTUpO1xuICAgIHRoaXMuc2NlbmUuYWRkKGFtYmllbnRMaWdodCk7XG5cbiAgICBjb25zdCBkaXJlY3Rpb25hbExpZ2h0MSA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmLCAwLjUpO1xuICAgIGRpcmVjdGlvbmFsTGlnaHQxLnBvc2l0aW9uLnNldCgwLCAwLCAxKTtcbiAgICB0aGlzLnNjZW5lLmFkZChkaXJlY3Rpb25hbExpZ2h0MSk7XG5cbiAgICBjb25zdCBkaXJlY3Rpb25hbExpZ2h0MiA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmLCAwLjUpO1xuICAgIGRpcmVjdGlvbmFsTGlnaHQyLnBvc2l0aW9uLnNldCgxLCAwLCAwKTtcbiAgICB0aGlzLnNjZW5lLmFkZChkaXJlY3Rpb25hbExpZ2h0Mik7XG5cbiAgICBjb25zdCBkaXJlY3Rpb25hbExpZ2h0MyA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmLCAwLjUpO1xuICAgIGRpcmVjdGlvbmFsTGlnaHQzLnBvc2l0aW9uLnNldCgwLCAxLCAwKTtcbiAgICB0aGlzLnNjZW5lLmFkZChkaXJlY3Rpb25hbExpZ2h0Myk7XG5cbiAgICAvLyBGb2dcbiAgICB0aGlzLnNjZW5lLmZvZyA9IG5ldyBUSFJFRS5Gb2coMHhmZmZmZmYsIGZvZ0Rpc3RhbmNlLCBmb2dEaXN0YW5jZSArIDEwMDApO1xuICAgIHRoaXMuY2FtZXJhLmZhciA9IGZvZ0Rpc3RhbmNlICsgMTAwMDtcbiAgICB0aGlzLmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XG5cbiAgICAvLy8gU3RhbmRhcmQgVEhSRUUgcmVuZGVyZXIgd2l0aCBBQVxuICAgIHRoaXMucmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7XG4gICAgICBhbnRpYWxpYXNpbmc6IHRydWUsXG4gICAgICBsb2dhcml0aG1pY0RlcHRoQnVmZmVyOiB0cnVlLFxuICAgICAgc29ydE9iamVjdHM6IGZhbHNlLFxuICAgICAgc3RlbmNpbDogZmFsc2UsXG4gICAgICBwcmVtdWx0aXBsaWVkQWxwaGE6IGZhbHNlLFxuICAgIH0pO1xuICAgIHRoaXMucmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U2l6ZShjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldENsZWFyQ29sb3IoY2FudmFzQ2xlYXJDb2xvcik7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBTQ1JFRU5fSEVJR0hUID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgY29uc3QgU0NSRUVOX1dJRFRIID0gd2luZG93LmlubmVyV2lkdGg7XG5cbiAgICAgIHRoaXMuY2FtZXJhLmFzcGVjdCA9IFNDUkVFTl9XSURUSCAvIFNDUkVFTl9IRUlHSFQ7XG4gICAgICB0aGlzLmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XG4gICAgICB0aGlzLnNreUNhbWVyYS5hc3BlY3QgPSBTQ1JFRU5fV0lEVEggLyBTQ1JFRU5fSEVJR0hUO1xuICAgICAgdGhpcy5za3lDYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpO1xuXG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFNpemUoU0NSRUVOX1dJRFRILCBTQ1JFRU5fSEVJR0hUKTtcbiAgICB9KTtcblxuICAgIHRoaXMuc2V0dXBDb250cm9sbGVyKCk7XG5cbiAgICAvLy8gTm90ZTogY29uc3RhbnQgY29udGlub3VzIHJlbmRlcmluZyBmcm9tIHBhZ2UgbG9hZFxuICAgIHRoaXMuX3JlbmRlcigpO1xuICB9XG5cbiAgaXNDb2xsTW9kZWxzTG9hZGVkKCkge1xuICAgIHRoaXMubWFwRGF0YS5jb2xsaXNpb24ubG9hZGVkO1xuICB9XG5cbiAgaXNQcm9wTW9kZWxzTG9hZGVkKCkge1xuICAgIHJldHVybiB0aGlzLm1hcERhdGEucHJvcHMubG9hZGVkO1xuICB9XG5cbiAgaXNab25lTW9kZWxzTG9hZGVkKCkge1xuICAgIHJldHVybiB0aGlzLm1hcERhdGEuem9uZS5sb2FkZWQ7XG4gIH1cblxuICBsb2FkTWFwKG1hcElkKSB7XG4gICAgLy8gQ2xlYW4gcHJldmlvdXMgcmVuZGVyIHN0YXRlc1xuICAgIHRoaXMuX2NsZWFuTWFwRGF0YSgpO1xuICAgIHRoaXMubWFwRGF0YS5pZCA9IG1hcElkO1xuXG4gICAgLy8vIFJlbmRlcmVyIHNldHRpbmdzIChzZWUgdGhlIGRvY3VtZW50YXRpb24gb2YgZWFjaCBSZW5kZXJlciBmb3IgZGV0YWlscylcbiAgICBjb25zdCByZW5kZXJlcnMgPSBbXG4gICAgICB7XG4gICAgICAgIHJlbmRlckNsYXNzOiBUM0QuRW52aXJvbm1lbnRSZW5kZXJlcixcbiAgICAgICAgc2V0dGluZ3M6IHt9LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgcmVuZGVyQ2xhc3M6IFQzRC5UZXJyYWluUmVuZGVyZXIsXG4gICAgICAgIHNldHRpbmdzOiB7fSxcbiAgICAgIH0sXG4gICAgXTtcbiAgICAvLy8gTG9hZCBmb3IgdGhlIGZpcnN0IHRpbWUgdGhlIHJlbmRlcmVyIGFuZCBzcGF3biB0aGUgY29udGV4dFxuICAgIFQzRC5yZW5kZXJNYXBDb250ZW50c0FzeW5jKFxuICAgICAgdGhpcy5sb2NhbFJlYWRlcixcbiAgICAgIHRoaXMubWFwRGF0YS5pZCxcbiAgICAgIHJlbmRlcmVycyxcbiAgICAgIChjb250ZXh0KSA9PiB7XG4gICAgICAgIHRoaXMuX29uUmVuZGVyZXJEb25lKGNvbnRleHQpO1xuICAgICAgfSxcbiAgICAgIHRoaXMubG9nZ2VyXG4gICAgKTtcblxuICAgIC8vIENhY2hlIG1hcEZpbGUgZm9yIGxhdGVyIHVzZVxuICAgIGlmIChwYXJzZUludCh0aGlzLm1hcERhdGEuaWQpKSB7XG4gICAgICB0aGlzLmxvY2FsUmVhZGVyLmxvYWRGaWxlKHRoaXMubWFwRGF0YS5pZCwgKGFycmF5QnVmZmVyKSA9PiB7XG4gICAgICAgIGNvbnN0IGRzID0gbmV3IERhdGFTdHJlYW0oYXJyYXlCdWZmZXIsIDAsIERhdGFTdHJlYW0uTElUVExFX0VORElBTik7XG4gICAgICAgIHRoaXMubWFwRGF0YS5tYXBGaWxlID0gbmV3IFQzRC5HVzJGaWxlKGRzLCAwKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGxvYWRab25lTW9kZWxzKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5fbG9hZE1lc2hlcyhUM0QuWm9uZVJlbmRlcmVyLCB0aGlzLm1hcERhdGEuem9uZSwgY2FsbGJhY2spO1xuICB9XG5cbiAgbG9hZFByb3BNb2RlbHMoY2FsbGJhY2spIHtcbiAgICB0aGlzLl9sb2FkTWVzaGVzKFQzRC5Qcm9wZXJ0aWVzUmVuZGVyZXIsIHRoaXMubWFwRGF0YS5wcm9wcywgY2FsbGJhY2spO1xuICB9XG5cbiAgbG9hZENvbGxNb2RlbHMoY2FsbGJhY2spIHtcbiAgICB0aGlzLl9sb2FkTWVzaGVzKFQzRC5IYXZva1JlbmRlcmVyLCB0aGlzLm1hcERhdGEuY29sbGlzaW9uLCBjYWxsYmFjayk7XG4gIH1cblxuICBzZXRGb2coZm9nRGlzdGFuY2UpIHtcbiAgICBpZiAodGhpcy5zY2VuZSAmJiB0aGlzLnNjZW5lLmZvZykge1xuICAgICAgdGhpcy5zY2VuZS5mb2cubmVhciA9IGZvZ0Rpc3RhbmNlO1xuICAgICAgdGhpcy5zY2VuZS5mb2cuZmFyID0gZm9nRGlzdGFuY2UgKyAxMDAwO1xuICAgIH1cbiAgICBpZiAodGhpcy5jYW1lcmEpIHtcbiAgICAgIHRoaXMuY2FtZXJhLmZhciA9IGZvZ0Rpc3RhbmNlICsgMTAwMDtcbiAgICAgIHRoaXMuY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcbiAgICB9XG4gIH1cblxuICBzZXRNb3ZlbWVudFNwZWVkKHNwZWVkKSB7XG4gICAgaWYgKHRoaXMuY29udHJvbHMpIHtcbiAgICAgIHRoaXMuY29udHJvbHMubW92ZW1lbnRTcGVlZCA9IHNwZWVkO1xuICAgIH1cbiAgfVxuXG4gIGdldE1vdmVtZW50U3BlZWQoKSB7XG4gICAgaWYgKHRoaXMuY29udHJvbHMpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnRyb2xzLm1vdmVtZW50U3BlZWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICB0b2dnbGVab25lTW9kZWxzKCkge1xuICAgIHJldHVybiB0aGlzLl90b2dnbGVNb2RlbHMoXCJ6b25lXCIpO1xuICB9XG5cbiAgdG9nZ2xlUHJvcE1vZGVscygpIHtcbiAgICByZXR1cm4gdGhpcy5fdG9nZ2xlTW9kZWxzKFwicHJvcHNcIik7XG4gIH1cblxuICB0b2dnbGVDb2xsTW9kZWxzKCkge1xuICAgIHJldHVybiB0aGlzLl90b2dnbGVNb2RlbHMoXCJjb2xsaXNpb25cIik7XG4gIH1cblxuICAvKipcbiAgICogUHJpdmF0ZSBtZXRob2RzXG4gICAqL1xuXG4gIF9jbGVhbk1hcERhdGEoKSB7XG4gICAgdGhpcy5tYXBEYXRhID0ge1xuICAgICAgaWQ6IG51bGwsXG4gICAgICBtYXBGaWxlOiBudWxsLFxuICAgICAgdGVycmFpbjoge1xuICAgICAgICBkYXRhOiBbXSxcbiAgICAgIH0sXG4gICAgICBjb2xsaXNpb246IHtcbiAgICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICAgIGxvYWRlZDogZmFsc2UsXG4gICAgICAgIGRhdGE6IFtdLFxuICAgICAgfSxcbiAgICAgIHByb3BzOiB7XG4gICAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICBsb2FkZWQ6IGZhbHNlLFxuICAgICAgICBkYXRhOiBbXSxcbiAgICAgIH0sXG4gICAgICB6b25lOiB7XG4gICAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICBsb2FkZWQ6IGZhbHNlLFxuICAgICAgICBkYXRhOiBbXSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8vLyBXaXBlcyBvdXQgdGhlIGRhdGFcbiAgX2NsZWFuU2NlbmUoKSB7XG4gICAgZm9yIChjb25zdCB0eXBlIG9mIFtcInRlcnJhaW5cIiwgXCJwcm9wc1wiLCBcInpvbmVcIiwgXCJjb2xsaXNpb25cIl0pIHtcbiAgICAgIGZvciAoY29uc3QgZWxlbSBvZiB0aGlzLm1hcERhdGFbdHlwZV0uZGF0YSkge1xuICAgICAgICB0aGlzLnNjZW5lLnJlbW92ZShlbGVtKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubWFwRGF0YVt0eXBlXS5kYXRhID0gW107XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCB0eXBlIG9mIFtcInByb3BzXCIsIFwiem9uZVwiLCBcImNvbGxpc2lvblwiXSkge1xuICAgICAgdGhpcy5tYXBEYXRhW3R5cGVdLmxvYWRlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5tYXBEYXRhW3R5cGVdLmVuYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvLy8gUnVuIGEgcmVuZGVyZXIgbWFudWFsbHkgYW5kIHBvcHVsYXRlcyB0aGUgZGF0YSBvYmplY3RcbiAgX2xvYWRNZXNoZXMocmVuZGVyZXJDbGFzcywgb3V0UmVuZGVyZXJEYXRhLCBjYWxsYmFjaykge1xuICAgIFQzRC5ydW5SZW5kZXJlcihcbiAgICAgIHJlbmRlcmVyQ2xhc3MsXG4gICAgICB0aGlzLmxvY2FsUmVhZGVyLFxuICAgICAgeyB2aXNpYmxlOiB0cnVlLCBtYXBGaWxlOiB0aGlzLm1hcERhdGEubWFwRmlsZSwgc2hvd1VubWF0ZXJpYWxpemVkOiBmYWxzZSB9LFxuICAgICAgdGhpcy5jb250ZXh0LFxuICAgICAgKCkgPT4ge1xuICAgICAgICBvdXRSZW5kZXJlckRhdGEuZGF0YSA9IFQzRC5nZXRDb250ZXh0VmFsdWUodGhpcy5jb250ZXh0LCByZW5kZXJlckNsYXNzLCBcIm1lc2hlc1wiKTtcbiAgICAgICAgb3V0UmVuZGVyZXJEYXRhLmxvYWRlZCA9IHRydWU7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIHNldHVwQ29udHJvbGxlcigpIHtcbiAgICBpZiAodGhpcy5jb250cm9scykge1xuICAgICAgdGhpcy5jb250cm9scy5kaXNwb3NlKCk7XG4gICAgfVxuXG4gICAgY29uc3QgY29udHJvbHMgPSBuZXcgVEhSRUUuRmx5Q29udHJvbHModGhpcy5jYW1lcmEsIHRoaXMucmVuZGVyZXIuZG9tRWxlbWVudCk7XG5cbiAgICBjb250cm9scy5tb3ZlbWVudFNwZWVkID0gTnVtYmVyKCQoXCIjbXZudFNwZWVkUmFuZ2VcIikudmFsKCkpIHwgMTAwMDtcbiAgICBjb250cm9scy5kb21FbGVtZW50ID0gdGhpcy5yZW5kZXJlci5kb21FbGVtZW50O1xuICAgIGNvbnRyb2xzLnJvbGxTcGVlZCA9IE1hdGguUEkgLyA2O1xuICAgIGNvbnRyb2xzLmF1dG9Gb3J3YXJkID0gZmFsc2U7XG4gICAgY29udHJvbHMuZHJhZ1RvTG9vayA9IHRydWU7XG4gICAgdGhpcy5jb250cm9scyA9IGNvbnRyb2xzO1xuICB9XG5cbiAgX3JlbmRlcigpIHtcbiAgICBnbG9iYWwuc3RhdHMudXBkYXRlKCk7XG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLl9yZW5kZXIoKSk7XG5cbiAgICBjb25zdCBkZWx0YSA9IHRoaXMuY2xvY2suZ2V0RGVsdGEoKTtcbiAgICB0aGlzLmNvbnRyb2xzLnVwZGF0ZShkZWx0YSk7XG5cbiAgICAvLyBSZW5kZXIgZmlyc3Qgc2t5Q2FtZXJhXG4gICAgdGhpcy5za3lDYW1lcmEucXVhdGVybmlvbi5jb3B5KHRoaXMuY2FtZXJhLnF1YXRlcm5pb24pO1xuICAgIHRoaXMucmVuZGVyZXIuY2xlYXIodGhpcy5yZW5kZXJlci5nZXRDbGVhckNvbG9yKCkpO1xuICAgIHRoaXMucmVuZGVyZXIucmVuZGVyKHRoaXMuc2t5U2NlbmUsIHRoaXMuc2t5Q2FtZXJhKTtcblxuICAgIHRoaXMucmVuZGVyZXIucmVuZGVyKHRoaXMuc2NlbmUsIHRoaXMuY2FtZXJhKTtcbiAgfVxuXG4gIF90b2dnbGVNb2RlbHMobWVzaFR5cGUpIHtcbiAgICBpZiAodGhpcy5tYXBEYXRhW21lc2hUeXBlXS5lbmFibGVkKSB7XG4gICAgICBmb3IgKGNvbnN0IGVsZW0gb2YgdGhpcy5tYXBEYXRhW21lc2hUeXBlXS5kYXRhKSB7XG4gICAgICAgIHRoaXMuc2NlbmUucmVtb3ZlKGVsZW0pO1xuICAgICAgfVxuICAgICAgdGhpcy5tYXBEYXRhW21lc2hUeXBlXS5lbmFibGVkID0gZmFsc2U7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAoY29uc3QgZWxlbSBvZiB0aGlzLm1hcERhdGFbbWVzaFR5cGVdLmRhdGEpIHtcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQoZWxlbSk7XG4gICAgICB9XG4gICAgICB0aGlzLm1hcERhdGFbbWVzaFR5cGVdLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgLy8vIFJ1bnMgd2hlbiB0aGUgTW9kZWxSZW5kZXJlciBpcyBmaW5pc2hlZFxuICBfb25SZW5kZXJlckRvbmUoY29udGV4dCkge1xuICAgIHRoaXMuX2NsZWFuU2NlbmUoKTtcblxuICAgIC8vLyBQb3B1bGF0ZSBvdXIgY29udGV4dCB3aXRoIHRoZSBjb250ZXh0IHJldHVybmVkXG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcblxuICAgIC8vLyBUYWtlIGFsbCB0aGUgdGVycmFpbiB0aWxlcyBnZW5lcmF0ZWQgYnkgdGhlIFRlcnJhaW5SZW5kZXJlciBhbmQgYWRkIHRoZW0gdG8gdGhlIHNjZW5lXG4gICAgZm9yIChjb25zdCBlbGVtIG9mIFQzRC5nZXRDb250ZXh0VmFsdWUoY29udGV4dCwgVDNELlRlcnJhaW5SZW5kZXJlciwgXCJ0ZXJyYWluVGlsZXNcIikpIHtcbiAgICAgIHRoaXMuc2NlbmUuYWRkKGVsZW0pO1xuICAgICAgdGhpcy5tYXBEYXRhLnRlcnJhaW4uZGF0YS5wdXNoKGVsZW0pO1xuICAgIH1cblxuICAgIC8vLyBTa3lib3hcbiAgICBjb25zdCBza3lCb3ggPSBUM0QuZ2V0Q29udGV4dFZhbHVlKGNvbnRleHQsIFQzRC5FbnZpcm9ubWVudFJlbmRlcmVyLCBcInNreUJveFwiKTtcbiAgICB0aGlzLnNreVNjZW5lLmFkZChza3lCb3gpO1xuICAgIGNvbnN0IGhhemVDb2xvciA9IFQzRC5nZXRDb250ZXh0VmFsdWUoY29udGV4dCwgVDNELkVudmlyb25tZW50UmVuZGVyZXIsIFwiaGF6ZUNvbG9yXCIpO1xuICAgIGlmIChoYXplQ29sb3IpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0Q2xlYXJDb2xvcihuZXcgVEhSRUUuQ29sb3IoaGF6ZUNvbG9yWzJdIC8gMjU1LCBoYXplQ29sb3JbMV0gLyAyNTUsIGhhemVDb2xvclswXSAvIDI1NSkpO1xuICAgIH1cblxuICAgIC8vLyBBZGQgdGhlIHdhdGVyIGxldmVsIHRvIHRoZSBzY2VuZVxuICAgIGNvbnN0IHdhdGVyID0gVDNELmdldENvbnRleHRWYWx1ZShjb250ZXh0LCBUM0QuVGVycmFpblJlbmRlcmVyLCBcIndhdGVyXCIpO1xuICAgIHRoaXMuc2NlbmUuYWRkKHdhdGVyKTtcbiAgICB0aGlzLm1hcERhdGEudGVycmFpbi5kYXRhLnB1c2god2F0ZXIpO1xuXG4gICAgLy8vIE1vdmUgdGhlIGNhbWVyYSBpbml0aWFsIHBsYWNlIGRlcGVuZGluZyBvbiB0aGUgbWFwIGJvdW5kc1xuICAgIGNvbnN0IGJvdW5kcyA9IFQzRC5nZXRDb250ZXh0VmFsdWUoY29udGV4dCwgVDNELlRlcnJhaW5SZW5kZXJlciwgXCJib3VuZHNcIik7XG4gICAgdGhpcy5jYW1lcmEucG9zaXRpb24ueCA9IDA7XG4gICAgdGhpcy5jYW1lcmEucG9zaXRpb24ueSA9IGJvdW5kcyA/IGJvdW5kcy55MiA6IDA7XG4gICAgdGhpcy5jYW1lcmEucG9zaXRpb24ueiA9IDA7XG4gICAgdGhpcy5jYW1lcmEucm90YXRpb24ueCA9ICgtOTAgKiBNYXRoLlBJKSAvIDE4MDtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEFwcFJlbmRlcmVyO1xuIl19"}