{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/index.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","window.onload = () => {\n  /// T3D\n  let _lr;\n  let _context;\n  let _fileId;\n  let _fileList;\n  let _audioSource;\n  let _audioContext;\n\n  /// THREE\n  let _scene;\n  let _camera;\n  let _renderer;\n  let _models = [];\n  let _controls;\n\n  $(function () {\n    /*\n        SET MAIN UP GRID\n        */\n    const pstyle = \"border: 1px solid #dfdfdf; padding: 0;\";\n    $(\"#layout\").w2layout({\n      name: \"layout\",\n      panels: [\n        {\n          type: \"left\",\n          size: 570,\n          resizable: true,\n          style: pstyle + \"margin:0\",\n        },\n        {\n          type: \"main\",\n          style: pstyle + \" background-color: transparent;\",\n          toolbar: {\n            style: \"background-color:#eaeaea; height:40px\",\n            items: [\n              {\n                type: \"html\",\n                id: \"fileIdToolbar\",\n                html:\n                  '<div class=\"toolbarEntry\">' +\n                  \" File ID:\" +\n                  '    <input id=\"fileIdInput\"/>' +\n                  '    <button id=\"fileIdInputBtn\">' +\n                  \"    Load </button>\" +\n                  \"</div>\",\n              },\n              {\n                type: \"html\",\n                id: \"contextToolbar\",\n                html: '<div class=\"toolbarEntry\" id=\"contextToolbar\"></div>',\n              },\n            ],\n            onClick: function (event) {\n              this.owner.content(\"main\", event);\n            },\n          },\n        },\n      ],\n      onResize: onCanvasResize,\n    });\n\n    $(\"#fileIdInputBtn\").click(function () {\n      viewFileByFileId($(\"#fileIdInput\").val());\n    });\n\n    /// Grid inside main left\n    $().w2layout({\n      name: \"leftLayout\",\n      panels: [\n        {\n          type: \"left\",\n          size: 150,\n          resizable: true,\n          style: pstyle,\n          content: \"left\",\n        },\n        {\n          type: \"main\",\n          size: 420,\n          resizable: true,\n          style: pstyle,\n          content: \"right\",\n        },\n      ],\n    });\n    w2ui[\"layout\"].content(\"left\", w2ui[\"leftLayout\"]);\n\n    /*\n            SIDEBAR\n            */\n    w2ui[\"leftLayout\"].content(\n      \"left\",\n      $().w2sidebar({\n        name: \"sidebar\",\n        img: null,\n        nodes: [{ id: \"All\", text: \"All\", img: \"icon-folder\", group: false }],\n        onClick: onFilterClick,\n      })\n    );\n\n    /*\n            SET UP FILE BROWSER\n            */\n    w2ui[\"leftLayout\"].content(\n      \"main\",\n      $().w2grid({\n        name: \"grid\",\n        show: {\n          toolbar: true,\n          footer: true,\n        },\n        columns: [\n          {\n            field: \"recid\",\n            caption: \"MFT index\",\n            size: \"80px\",\n            sortable: true,\n            resizable: true,\n            searchable: \"int\",\n          },\n          {\n            field: \"baseIds\",\n            caption: \"BaseId list\",\n            size: \"100%\",\n            sortable: true,\n            resizable: true,\n            searchable: true,\n          },\n          {\n            field: \"type\",\n            caption: \"Type\",\n            size: \"100px\",\n            resizable: true,\n            sortable: true,\n          },\n          {\n            field: \"fileSize\",\n            caption: \"Pack Size\",\n            size: \"85px\",\n            resizable: true,\n            sortable: true,\n          },\n        ],\n        onClick: function (event) {\n          viewFileByMFT(event.recid);\n        },\n      })\n    );\n\n    /*\n            SET UP FILE VIEW 'WINDOW'\n            */\n    $(w2ui[\"layout\"].el(\"main\"))\n      .append($(\"<h1 id='fileTitle' />\"))\n      .append($(\"<div id='fileTabs' />\"))\n      .append($(\"<div class='fileTab' id='fileTabsRaw'>\" + \"<div class='tabOutput' id='rawOutput' />\" + \"</div>\"))\n      .append(\n        $(\"<div class='fileTab' id='fileTabsPack'>\" + \"<div class='tabOutput' id='packOutput' />\" + \"</div>\").hide()\n      )\n      .append(\n        $(\n          \"<div class='fileTab' id='fileTabsTexture'>\" + \"<div class='tabOutput' id='textureOutput' />\" + \"</div>\"\n        ).hide()\n      )\n      .append($(\"<div class='fileTab' id='fileTabsString'>\" + \"<div id='stringOutput' />\" + \"</div>\").hide())\n      .append($(\"<div class='fileTab' id='fileTabsModel'>\" + \"<div id='modelOutput'/>\" + \"</div>\").hide())\n      .append(\n        $(\"<div class='fileTab' id='fileTabsSound'>\" + \"<div class='tabOutput' id='soundOutput'/>\" + \"</div>\").hide()\n      );\n\n    $(\"#fileTabs\").w2tabs({\n      name: \"fileTabs\",\n      active: \"tabRaw\",\n      tabs: [\n        {\n          id: \"tabRaw\",\n          caption: \"Raw\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsRaw\").show();\n          },\n        },\n        {\n          id: \"tabPF\",\n          caption: \"Pack File\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsPack\").show();\n          },\n        },\n        {\n          id: \"tabTexture\",\n          caption: \"Texture\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsTexture\").show();\n          },\n        },\n        {\n          id: \"tabString\",\n          caption: \"String\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsString\").show();\n          },\n        },\n        {\n          id: \"tabModel\",\n          caption: \"Model\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsModel\").show();\n          },\n        },\n        {\n          id: \"tabSound\",\n          caption: \"Sound\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsSound\").show();\n          },\n        },\n      ],\n    });\n\n    /// Set up grid for strings view\n    ///Create grid\n    $(\"#stringOutput\").w2grid({\n      name: \"stringGrid\",\n      selectType: \"cell\",\n      show: {\n        toolbar: true,\n        footer: true,\n      },\n      columns: [\n        { field: \"recid\", caption: \"Row #\", size: \"60px\" },\n        { field: \"value\", caption: \"Text\", size: \"100%\" },\n      ],\n    });\n\n    /*\n            SET UP TREE 3D SCENE\n        */\n    setupScene();\n\n    /// Ask for file\n    w2popup.open({\n      speed: 0,\n      title: \"Load A GW2 dat\",\n      modal: true,\n      showClose: false,\n      body:\n        '<div class=\"w2ui-centered\">' +\n        '<div id=\"fileLoadProgress\" />' +\n        '<input id=\"filePickerPop\" type=\"file\" />' +\n        \"</div>\",\n    });\n\n    $(\"#filePickerPop\").change(function (evt) {\n      _lr = T3D.getLocalReader(evt.target.files[0], onReaderCreated, \"./static/t3dworker.js\");\n    });\n\n    /// Overwrite progress logger\n    T3D.Logger.logFunctions[T3D.Logger.TYPE_PROGRESS] = function () {\n      $(\"#filePickerPop\").prop(\"disabled\", true);\n      $(\"#fileLoadProgress\").html(\"Indexing .dat file (first visit only)<br/>\" + arguments[1] + \"%<br/><br/>\");\n    };\n  });\n\n  function onReaderCreated() {\n    T3D.getFileListAsync(\n      _lr,\n      function (files) {\n        /// Store fileList globally\n        _fileList = files;\n\n        const packNode = {\n          id: \"packGroup\",\n          text: \"Pack Files\",\n          img: \"icon-folder\",\n          group: false,\n          nodes: [],\n        };\n\n        const textureNode = {\n          id: \"textureGroup\",\n          text: \"Texture files\",\n          img: \"icon-folder\",\n          group: false,\n          nodes: [],\n        };\n\n        const unsortedNode = {\n          id: \"unsortedGroup\",\n          text: \"Unsorted\",\n          img: \"icon-folder\",\n          group: false,\n          nodes: [],\n        };\n\n        /// Build sidebar nodes\n        for (const fileType in _fileList) {\n          if (Object.getOwnPropertyNames(_fileList).includes(fileType)) {\n            let node = { id: fileType, img: \"icon-folder\", group: false };\n            //let isPack = false;\n            if (fileType.startsWith(\"TEXTURE\")) {\n              node = {\n                id: fileType,\n                img: \"icon-folder\",\n                group: false,\n                text: fileType,\n              };\n              textureNode.nodes.push(node);\n            } else if (fileType === \"BINARIES\") {\n              node.text = \"Binaries\";\n              w2ui.sidebar.add(node);\n            } else if (fileType === \"STRINGS\") {\n              node.text = \"Strings\";\n              w2ui.sidebar.add(node);\n            } else if (fileType.startsWith(\"PF\")) {\n              node = {\n                id: fileType,\n                img: \"icon-folder\",\n                group: false,\n                text: fileType,\n              };\n              packNode.nodes.push(node);\n            } else if (fileType === \"UNKNOWN\") {\n              node.text = \"Unknown\";\n              w2ui.sidebar.add(node);\n            } else {\n              node = {\n                id: fileType,\n                img: \"icon-folder\",\n                group: false,\n                text: fileType,\n              };\n              unsortedNode.nodes.push(node);\n            }\n          }\n        }\n\n        if (packNode.nodes.length > 0) {\n          w2ui.sidebar.add(packNode);\n        }\n\n        if (textureNode.nodes.length > 0) {\n          w2ui.sidebar.add(textureNode);\n        }\n\n        if (unsortedNode.nodes.length > 0) {\n          w2ui.sidebar.add(unsortedNode);\n        }\n\n        /// Close the pop\n        w2popup.close();\n\n        /// Select the \"All\" category\n        w2ui.sidebar.click(\"All\");\n      } /// End getFileListAsync callback\n    );\n  }\n\n  function onFilterClick(evt) {\n    /// No filter if clicked group was \"All\"\n    if (evt.target === \"All\") {\n      showFileGroup();\n    }\n\n    /// Other events are fine to just pass\n    else {\n      showFileGroup([evt.target]);\n    }\n  }\n\n  function showFileGroup(fileTypeFilter) {\n    w2ui.grid.records = [];\n\n    const reverseTable = _lr.getReverseIndex();\n\n    for (const fileType in _fileList) {\n      /// Only show types we've asked for\n      if (fileTypeFilter && fileTypeFilter.indexOf(fileType) < 0) {\n        /// Special case for \"packGroup\"\n        /// Should let trough all pack types\n        /// Should NOT let trought any non-pack types\n        /// i.e. Strings, Binaries etc\n        if (fileTypeFilter.indexOf(\"packGroup\") >= 0) {\n          if (!fileType.startsWith(\"PF\")) {\n            continue;\n          }\n        } else if (fileTypeFilter.indexOf(\"textureGroup\") >= 0) {\n          if (!fileType.startsWith(\"TEXTURE\")) {\n            continue;\n          }\n        } else {\n          continue;\n        }\n      }\n\n      if (Object.keys(_fileList).includes(fileType)) {\n        const fileArr = _fileList[fileType];\n        fileArr.forEach(\n          function (mftIndex) {\n            const meta = _lr.getFileMeta(mftIndex);\n\n            const baseIds = reverseTable[mftIndex];\n            const fileSize = meta ? meta.size : \"\";\n\n            if (fileSize > 0 && mftIndex > 15) {\n              w2ui[\"grid\"].records.push({\n                recid: mftIndex, /// MFT index\n                baseIds: baseIds,\n                type: fileType,\n                fileSize: fileSize,\n              });\n            }\n\n            mftIndex++;\n          } /// End for each mft in this file type\n        );\n      } /// End if _fileList[filetype]\n    } /// End for each fileType key in _fileList object\n\n    /// Update file grid\n    w2ui.grid.refresh();\n  }\n\n  function viewFileByMFT(mftIdx) {\n    const reverseTable = _lr.getReverseIndex();\n\n    const baseId = reverseTable[mftIdx] ? reverseTable[mftIdx][0] : \"\";\n\n    viewFileByFileId(baseId);\n  }\n\n  function viewFileByFileId(fileId) {\n    /// Clean outputs\n    $(\".tabOutput\").html(\"\");\n    $(\"#fileTitle\").html(\"\");\n\n    /// Clean context toolbar\n    $(\"#contextToolbar\").html(\"\");\n\n    /// Disable tabs\n    w2ui.fileTabs.disable(\"tabRaw\");\n    w2ui.fileTabs.disable(\"tabPF\");\n    w2ui.fileTabs.disable(\"tabTexture\");\n    w2ui.fileTabs.disable(\"tabString\");\n    w2ui.fileTabs.disable(\"tabModel\");\n    w2ui.fileTabs.disable(\"tabSound\");\n\n    /// Remove old models from the scene\n    if (_models) {\n      _models.forEach(function (mdl) {\n        _scene.remove(mdl);\n      });\n    }\n\n    /// Make sure _context is clean\n    _context = {};\n\n    /// Run the basic DataRenderer, handles all sorts of files for us.\n    T3D.runRenderer(T3D.DataRenderer, _lr, { id: fileId }, _context, onBasicRendererDone);\n  }\n\n  function onBasicRendererDone() {\n    /// Read render output from _context VO\n    const fileId = (_fileId = T3D.getContextValue(_context, T3D.DataRenderer, \"fileId\"));\n\n    const rawData = T3D.getContextValue(_context, T3D.DataRenderer, \"rawData\");\n\n    const raw = T3D.getContextValue(_context, T3D.DataRenderer, \"rawString\");\n\n    const packfile = T3D.getContextValue(_context, T3D.DataRenderer, \"file\");\n\n    const image = T3D.getContextValue(_context, T3D.DataRenderer, \"image\");\n\n    const fcc = raw.substring(0, 4);\n\n    /// Update main header to show filename\n\n    const fileName = fileId + (image || !packfile ? \".\" + fcc : \".\" + packfile.header.type);\n    $(\"#fileTitle\").html(fileName);\n\n    /// Update raw view and enable tab\n    w2ui.fileTabs.enable(\"tabRaw\");\n\n    $(\"#contextToolbar\").append(\n      $(\"<button>Download raw</button>\").click(function () {\n        const blob = new Blob([rawData], { type: \"octet/stream\" });\n        saveData(blob, fileName + \".raw\");\n      })\n    );\n\n    $(\"#rawOutput\").append($(\"<div>\").text(raw));\n\n    const ui8aRawData = new Uint8Array(rawData);\n\n    /// Texture file\n    if (image) {\n      /// Select texture tab\n      w2ui.fileTabs.enable(\"tabTexture\");\n      w2ui.fileTabs.click(\"tabTexture\");\n\n      /// Display bitmap on canvas\n      const canvas = $(\"<canvas>\");\n      canvas[0].width = image.width;\n      canvas[0].height = image.height;\n      const ctx = canvas[0].getContext(\"2d\");\n      const uica = new Uint8ClampedArray(image.data);\n      const imagedata = new ImageData(uica, image.width, image.height);\n      ctx.putImageData(imagedata, 0, 0);\n\n      $(\"#textureOutput\").append(canvas);\n    }\n\n    // PNG texture\n    else if (\n      ui8aRawData.length > 4 &&\n      ui8aRawData[0] === 137 &&\n      ui8aRawData[1] === 80 && // P\n      ui8aRawData[2] === 78 && // N\n      ui8aRawData[3] === 71 // G\n    ) {\n      /// Select texture tab\n      w2ui.fileTabs.enable(\"tabTexture\");\n      w2ui.fileTabs.click(\"tabTexture\");\n\n      const canvas = $(\"<canvas>\");\n      const pngBlob = new Blob([rawData], { type: \"image/png\" });\n      const url = URL.createObjectURL(pngBlob);\n      const img = new Image();\n      img.onload = function () {\n        canvas[0].width = img.width;\n        canvas[0].height = img.height;\n        const ctx = canvas[0].getContext(\"2d\");\n        ctx.drawImage(this, 0, 0);\n        URL.revokeObjectURL(url);\n      };\n      img.src = url;\n      $(\"#textureOutput\").append(canvas);\n      $(\"#contextToolbar\")\n        .show()\n        .append(\n          $(\"<button>Download Image</button>\").click(function () {\n            const blob = new Blob([rawData], { type: \"octet/stream\" });\n            saveData(blob, fileId + \".png\");\n          })\n        );\n    }\n\n    // RIFF texture\n    else if (\n      ui8aRawData.length > 4 &&\n      ui8aRawData[0] === 82 && // R\n      ui8aRawData[1] === 73 && // I\n      ui8aRawData[2] === 70 && // F\n      ui8aRawData[3] === 70 // F\n    ) {\n      /// Select texture tab\n      w2ui.fileTabs.enable(\"tabTexture\");\n      w2ui.fileTabs.click(\"tabTexture\");\n\n      const canvas = $(\"<canvas>\");\n      const riffBlob = new Blob([rawData], { type: \"image/webp\" });\n      const url = URL.createObjectURL(riffBlob);\n      const img = new Image();\n      img.onload = function () {\n        canvas[0].width = img.width;\n        canvas[0].height = img.height;\n        const ctx = canvas[0].getContext(\"2d\");\n        ctx.drawImage(this, 0, 0);\n        URL.revokeObjectURL(url);\n      };\n      img.src = url;\n      $(\"#textureOutput\").append(canvas);\n      $(\"#contextToolbar\")\n        .show()\n        .append(\n          $(\"<button>Download Image</button>\").click(function () {\n            const blob = new Blob([rawData], { type: \"octet/stream\" });\n            saveData(blob, fileId + \".riff\");\n          })\n        );\n    }\n\n    /// PF Pack file\n    else if (packfile) {\n      /// Always render the pack file chunk data\n      displayPackFile();\n\n      /// Enable corresponding tab\n      w2ui.fileTabs.enable(\"tabPF\");\n\n      /// If the pack file was a model, render it!\n      if (packfile.header.type === \"MODL\") {\n        /// Render model\n        renderFileModel(fileId);\n      } else if (packfile.header.type === \"ASND\") {\n        /// Get a chunk, this is really the job of a renderer but whatevs\n        const chunk = packfile.getChunk(\"ASND\");\n\n        /// Enable and select sound tab\n        w2ui.fileTabs.enable(\"tabSound\");\n        w2ui.fileTabs.click(\"tabSound\");\n\n        /// Print some random data about this sound\n        $(\"#soundOutput\").html(\n          \"Length: \" + chunk.data.length + \" seconds<br/>\" + \"Size: \" + chunk.data.audioData.length + \" bytes\"\n        );\n\n        /// Extract sound data\n\n        const soundUintArray = chunk.data.audioData;\n\n        $(\"#contextToolbar\")\n          .show()\n          .append(\n            $(\"<button>Download MP3</button>\").click(function () {\n              const blob = new Blob([soundUintArray], { type: \"octet/stream\" });\n              saveData(blob, fileName + \".mp3\");\n            })\n          )\n          .append(\n            $(\"<button>Play MP3</button>\").click(function () {\n              if (!_audioContext) {\n                _audioContext = new AudioContext();\n              }\n\n              /// Stop previous sound\n              try {\n                _audioSource.stop();\n              } catch (e) {\n                console.error(e);\n              }\n\n              /// Create new buffer for current sound\n              _audioSource = _audioContext.createBufferSource();\n              _audioSource.connect(_audioContext.destination);\n\n              /// Decode and start playing\n              _audioContext.decodeAudioData(soundUintArray.buffer, function (res) {\n                _audioSource.buffer = res;\n                _audioSource.start();\n              });\n            })\n          )\n          .append(\n            $(\"<button>Stop MP3</button>\").click(function () {\n              try {\n                _audioSource.stop();\n              } catch (e) {\n                console.error(e);\n              }\n            })\n          );\n      } else {\n        /// Select PF tab\n        w2ui.fileTabs.click(\"tabPF\");\n      }\n    } else if (fcc === \"strs\") {\n      showFileString(fileId);\n    }\n\n    /// Else just show raw view\n    else {\n      w2ui.fileTabs.click(\"tabRaw\");\n    }\n  }\n\n  function displayPackFile() {\n    //let fileId = T3D.getContextValue(_context, T3D.DataRenderer, \"fileId\");\n    const packfile = T3D.getContextValue(_context, T3D.DataRenderer, \"file\");\n\n    $(\"#packOutput\").html(\"\");\n    $(\"#packOutput\").append($(\"<h2>Chunks</h2>\"));\n\n    packfile.chunks.forEach(function (chunk) {\n      const field = $(\"<fieldset />\");\n      const legend = $(\"<legend>\" + chunk.header.type + \"</legend>\");\n\n      const logButton = $(\"<button>Log Chunk Data to Console</button>\");\n      logButton.click(function () {\n        T3D.Logger.log(T3D.Logger.TYPE_MESSAGE, \"Logging\", chunk.header.type, \"chunk\");\n        T3D.Logger.log(T3D.Logger.TYPE_MESSAGE, chunk.data);\n      });\n\n      field.append(legend);\n      field.append($(\"<p>Size:\" + chunk.header.chunkDataSize + \"</p>\"));\n      field.append(logButton);\n\n      $(\"#packOutput\").append(field);\n      $(\"#packOutput\").show();\n    });\n  }\n\n  function showFileString(fileId) {\n    /// Make sure output is clean\n    _context = {};\n\n    /// Run single renderer\n    T3D.runRenderer(T3D.StringRenderer, _lr, { id: fileId }, _context, onRendererDoneString);\n  }\n\n  function onRendererDoneString() {\n    /// Read data from renderer\n    const strings = T3D.getContextValue(_context, T3D.StringRenderer, \"strings\", []);\n\n    w2ui.stringGrid.records = strings;\n\n    w2ui.stringGrid.buffered = w2ui.stringGrid.records.length;\n    w2ui.stringGrid.total = w2ui.stringGrid.buffered;\n    w2ui.stringGrid.refresh();\n\n    /// Select this view\n    w2ui.fileTabs.enable(\"tabString\");\n    w2ui.fileTabs.click(\"tabString\");\n  }\n\n  function renderFileModel(fileId) {\n    const packfile = T3D.getContextValue(_context, T3D.DataRenderer, \"file\");\n    const hasModel = packfile.chunks.find((chunk) => chunk.header.type === \"MODL\");\n\n    /// Make sure output is clean\n    _context = {};\n\n    if (hasModel) {\n      /// Run single renderer\n      T3D.runRenderer(T3D.SingleModelRenderer, _lr, { id: fileId }, _context, onRendererDoneModel);\n    } else {\n      w2ui.fileTabs.click(\"tabPF\");\n    }\n  }\n\n  function onRendererDoneModel() {\n    /// Enable and select model tab\n    w2ui.fileTabs.enable(\"tabModel\");\n    w2ui.fileTabs.click(\"tabModel\");\n    $(\"#modelOutput\").show();\n\n    /// Re-fit canvas\n    onCanvasResize();\n\n    /// Add context toolbar export button\n    $(\"#contextToolbar\").append($(\"<button>Export scene</button>\").click(exportScene));\n\n    /// Read the new models\n    _models = T3D.getContextValue(_context, T3D.SingleModelRenderer, \"meshes\", []);\n\n    /// Keeping track of the biggest model for later\n    let biggestMdl = null;\n\n    /// Add all models to the scene\n    _models.forEach(function (model) {\n      /// Find the biggest model for camera focus/fitting\n      if (!biggestMdl || biggestMdl.boundingSphere.radius < model.boundingSphere.radius) {\n        biggestMdl = model;\n      }\n\n      _scene.add(model);\n    });\n\n    /// Reset any zoom and transaltion/rotation done when viewing earlier models.\n    _controls.reset();\n\n    /// Focus camera to the bigest model, doesn't work great.\n    let dist =\n      biggestMdl && biggestMdl.boundingSphere ? biggestMdl.boundingSphere.radius / Math.tan((Math.PI * 60) / 360) : 100;\n    dist = 1.2 * Math.max(100, dist);\n    dist = Math.min(1000, dist);\n    _camera.position.zoom = 1;\n    _camera.position.x = dist * Math.sqrt(2);\n    _camera.position.y = 50;\n    _camera.position.z = 0;\n\n    if (biggestMdl) _camera.lookAt(biggestMdl.position);\n  }\n\n  /// Exports current model as an .obj file with a .mtl refering .png textures.\n  function exportScene() {\n    /// Get last loaded fileId\n    const fileId = _fileId;\n\n    /// Run T3D hacked version of OBJExporter\n    const result = new THREE.OBJExporter().parse(_scene, fileId);\n\n    /// Download obj\n    const blob = new Blob([result], { type: \"octet/stream\" });\n    saveData(blob, \"export.\" + fileId + \".obj\");\n  }\n\n  /// Utility for downloading files to client\n  const saveData = (function () {\n    const a = document.createElement(\"a\");\n    document.body.appendChild(a);\n    a.style = \"display: none\";\n    return function (blob, fileName) {\n      const url = window.URL.createObjectURL(blob);\n      a.href = url;\n      a.download = fileName;\n      a.click();\n      window.URL.revokeObjectURL(url);\n    };\n  })();\n\n  /// Setting up a scene, Tree.js standard stuff...\n  function setupScene() {\n    const canvasWidth = $(\"#modelOutput\").width();\n    const canvasHeight = $(\"#modelOutput\").height();\n    const canvasClearColor = 0x342920; // For happy rendering, always use Van Dyke Brown.\n    const fov = 60;\n    const aspect = 1;\n    const near = 0.1;\n    const far = 500000;\n\n    _camera = new THREE.PerspectiveCamera(fov, aspect, near, far);\n\n    _scene = new THREE.Scene();\n\n    /// This scene has one ambient light source and three directional lights\n    const ambientLight = new THREE.AmbientLight(0x555555);\n    _scene.add(ambientLight);\n\n    const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);\n    directionalLight1.position.set(0, 0, 1);\n    _scene.add(directionalLight1);\n\n    const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.8);\n    directionalLight2.position.set(1, 0, 0);\n    _scene.add(directionalLight2);\n\n    const directionalLight3 = new THREE.DirectionalLight(0xffffff, 0.8);\n    directionalLight3.position.set(0, 1, 0);\n    _scene.add(directionalLight3);\n\n    /// Standard THREE renderer with AA\n    _renderer = new THREE.WebGLRenderer({ antialiasing: true });\n    $(\"#modelOutput\")[0].appendChild(_renderer.domElement);\n\n    _renderer.setSize(canvasWidth, canvasHeight);\n    _renderer.setClearColor(canvasClearColor);\n\n    /// Add THREE orbit controls, for simple orbiting, panning and zooming\n    _controls = new THREE.OrbitControls(_camera, _renderer.domElement);\n    _controls.enableZoom = true;\n\n    /// Sems w2ui delays resizing :/\n    $(window).resize(function () {\n      setTimeout(onCanvasResize, 10);\n    });\n\n    /// Note: constant continous rendering from page load event, not very opt.\n    render();\n  }\n\n  function onCanvasResize() {\n    const sceneWidth = $(\"#modelOutput\").width();\n    const sceneHeight = $(\"#modelOutput\").height();\n\n    if (!sceneHeight || !sceneWidth) return;\n\n    _camera.aspect = sceneWidth / sceneHeight;\n\n    _renderer.setSize(sceneWidth, sceneHeight);\n\n    _camera.updateProjectionMatrix();\n  }\n\n  /// Render loop, no game logic, just rendering.\n  function render() {\n    window.requestAnimationFrame(render);\n    _renderer.render(_scene, _camera);\n  }\n};\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIndpbmRvdy5vbmxvYWQgPSAoKSA9PiB7XG4gIC8vLyBUM0RcbiAgbGV0IF9scjtcbiAgbGV0IF9jb250ZXh0O1xuICBsZXQgX2ZpbGVJZDtcbiAgbGV0IF9maWxlTGlzdDtcbiAgbGV0IF9hdWRpb1NvdXJjZTtcbiAgbGV0IF9hdWRpb0NvbnRleHQ7XG5cbiAgLy8vIFRIUkVFXG4gIGxldCBfc2NlbmU7XG4gIGxldCBfY2FtZXJhO1xuICBsZXQgX3JlbmRlcmVyO1xuICBsZXQgX21vZGVscyA9IFtdO1xuICBsZXQgX2NvbnRyb2xzO1xuXG4gICQoZnVuY3Rpb24gKCkge1xuICAgIC8qXG4gICAgICAgIFNFVCBNQUlOIFVQIEdSSURcbiAgICAgICAgKi9cbiAgICBjb25zdCBwc3R5bGUgPSBcImJvcmRlcjogMXB4IHNvbGlkICNkZmRmZGY7IHBhZGRpbmc6IDA7XCI7XG4gICAgJChcIiNsYXlvdXRcIikudzJsYXlvdXQoe1xuICAgICAgbmFtZTogXCJsYXlvdXRcIixcbiAgICAgIHBhbmVsczogW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogXCJsZWZ0XCIsXG4gICAgICAgICAgc2l6ZTogNTcwLFxuICAgICAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICAgICAgICBzdHlsZTogcHN0eWxlICsgXCJtYXJnaW46MFwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogXCJtYWluXCIsXG4gICAgICAgICAgc3R5bGU6IHBzdHlsZSArIFwiIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50O1wiLFxuICAgICAgICAgIHRvb2xiYXI6IHtcbiAgICAgICAgICAgIHN0eWxlOiBcImJhY2tncm91bmQtY29sb3I6I2VhZWFlYTsgaGVpZ2h0OjQwcHhcIixcbiAgICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcImh0bWxcIixcbiAgICAgICAgICAgICAgICBpZDogXCJmaWxlSWRUb29sYmFyXCIsXG4gICAgICAgICAgICAgICAgaHRtbDpcbiAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwidG9vbGJhckVudHJ5XCI+JyArXG4gICAgICAgICAgICAgICAgICBcIiBGaWxlIElEOlwiICtcbiAgICAgICAgICAgICAgICAgICcgICAgPGlucHV0IGlkPVwiZmlsZUlkSW5wdXRcIi8+JyArXG4gICAgICAgICAgICAgICAgICAnICAgIDxidXR0b24gaWQ9XCJmaWxlSWRJbnB1dEJ0blwiPicgK1xuICAgICAgICAgICAgICAgICAgXCIgICAgTG9hZCA8L2J1dHRvbj5cIiArXG4gICAgICAgICAgICAgICAgICBcIjwvZGl2PlwiLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJodG1sXCIsXG4gICAgICAgICAgICAgICAgaWQ6IFwiY29udGV4dFRvb2xiYXJcIixcbiAgICAgICAgICAgICAgICBodG1sOiAnPGRpdiBjbGFzcz1cInRvb2xiYXJFbnRyeVwiIGlkPVwiY29udGV4dFRvb2xiYXJcIj48L2Rpdj4nLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICB0aGlzLm93bmVyLmNvbnRlbnQoXCJtYWluXCIsIGV2ZW50KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBvblJlc2l6ZTogb25DYW52YXNSZXNpemUsXG4gICAgfSk7XG5cbiAgICAkKFwiI2ZpbGVJZElucHV0QnRuXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZpZXdGaWxlQnlGaWxlSWQoJChcIiNmaWxlSWRJbnB1dFwiKS52YWwoKSk7XG4gICAgfSk7XG5cbiAgICAvLy8gR3JpZCBpbnNpZGUgbWFpbiBsZWZ0XG4gICAgJCgpLncybGF5b3V0KHtcbiAgICAgIG5hbWU6IFwibGVmdExheW91dFwiLFxuICAgICAgcGFuZWxzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiBcImxlZnRcIixcbiAgICAgICAgICBzaXplOiAxNTAsXG4gICAgICAgICAgcmVzaXphYmxlOiB0cnVlLFxuICAgICAgICAgIHN0eWxlOiBwc3R5bGUsXG4gICAgICAgICAgY29udGVudDogXCJsZWZ0XCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiBcIm1haW5cIixcbiAgICAgICAgICBzaXplOiA0MjAsXG4gICAgICAgICAgcmVzaXphYmxlOiB0cnVlLFxuICAgICAgICAgIHN0eWxlOiBwc3R5bGUsXG4gICAgICAgICAgY29udGVudDogXCJyaWdodFwiLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgICB3MnVpW1wibGF5b3V0XCJdLmNvbnRlbnQoXCJsZWZ0XCIsIHcydWlbXCJsZWZ0TGF5b3V0XCJdKTtcblxuICAgIC8qXG4gICAgICAgICAgICBTSURFQkFSXG4gICAgICAgICAgICAqL1xuICAgIHcydWlbXCJsZWZ0TGF5b3V0XCJdLmNvbnRlbnQoXG4gICAgICBcImxlZnRcIixcbiAgICAgICQoKS53MnNpZGViYXIoe1xuICAgICAgICBuYW1lOiBcInNpZGViYXJcIixcbiAgICAgICAgaW1nOiBudWxsLFxuICAgICAgICBub2RlczogW3sgaWQ6IFwiQWxsXCIsIHRleHQ6IFwiQWxsXCIsIGltZzogXCJpY29uLWZvbGRlclwiLCBncm91cDogZmFsc2UgfV0sXG4gICAgICAgIG9uQ2xpY2s6IG9uRmlsdGVyQ2xpY2ssXG4gICAgICB9KVxuICAgICk7XG5cbiAgICAvKlxuICAgICAgICAgICAgU0VUIFVQIEZJTEUgQlJPV1NFUlxuICAgICAgICAgICAgKi9cbiAgICB3MnVpW1wibGVmdExheW91dFwiXS5jb250ZW50KFxuICAgICAgXCJtYWluXCIsXG4gICAgICAkKCkudzJncmlkKHtcbiAgICAgICAgbmFtZTogXCJncmlkXCIsXG4gICAgICAgIHNob3c6IHtcbiAgICAgICAgICB0b29sYmFyOiB0cnVlLFxuICAgICAgICAgIGZvb3RlcjogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgY29sdW1uczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcInJlY2lkXCIsXG4gICAgICAgICAgICBjYXB0aW9uOiBcIk1GVCBpbmRleFwiLFxuICAgICAgICAgICAgc2l6ZTogXCI4MHB4XCIsXG4gICAgICAgICAgICBzb3J0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHNlYXJjaGFibGU6IFwiaW50XCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJiYXNlSWRzXCIsXG4gICAgICAgICAgICBjYXB0aW9uOiBcIkJhc2VJZCBsaXN0XCIsXG4gICAgICAgICAgICBzaXplOiBcIjEwMCVcIixcbiAgICAgICAgICAgIHNvcnRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgcmVzaXphYmxlOiB0cnVlLFxuICAgICAgICAgICAgc2VhcmNoYWJsZTogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcInR5cGVcIixcbiAgICAgICAgICAgIGNhcHRpb246IFwiVHlwZVwiLFxuICAgICAgICAgICAgc2l6ZTogXCIxMDBweFwiLFxuICAgICAgICAgICAgcmVzaXphYmxlOiB0cnVlLFxuICAgICAgICAgICAgc29ydGFibGU6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJmaWxlU2l6ZVwiLFxuICAgICAgICAgICAgY2FwdGlvbjogXCJQYWNrIFNpemVcIixcbiAgICAgICAgICAgIHNpemU6IFwiODVweFwiLFxuICAgICAgICAgICAgcmVzaXphYmxlOiB0cnVlLFxuICAgICAgICAgICAgc29ydGFibGU6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgb25DbGljazogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgdmlld0ZpbGVCeU1GVChldmVudC5yZWNpZCk7XG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICk7XG5cbiAgICAvKlxuICAgICAgICAgICAgU0VUIFVQIEZJTEUgVklFVyAnV0lORE9XJ1xuICAgICAgICAgICAgKi9cbiAgICAkKHcydWlbXCJsYXlvdXRcIl0uZWwoXCJtYWluXCIpKVxuICAgICAgLmFwcGVuZCgkKFwiPGgxIGlkPSdmaWxlVGl0bGUnIC8+XCIpKVxuICAgICAgLmFwcGVuZCgkKFwiPGRpdiBpZD0nZmlsZVRhYnMnIC8+XCIpKVxuICAgICAgLmFwcGVuZCgkKFwiPGRpdiBjbGFzcz0nZmlsZVRhYicgaWQ9J2ZpbGVUYWJzUmF3Jz5cIiArIFwiPGRpdiBjbGFzcz0ndGFiT3V0cHV0JyBpZD0ncmF3T3V0cHV0JyAvPlwiICsgXCI8L2Rpdj5cIikpXG4gICAgICAuYXBwZW5kKFxuICAgICAgICAkKFwiPGRpdiBjbGFzcz0nZmlsZVRhYicgaWQ9J2ZpbGVUYWJzUGFjayc+XCIgKyBcIjxkaXYgY2xhc3M9J3RhYk91dHB1dCcgaWQ9J3BhY2tPdXRwdXQnIC8+XCIgKyBcIjwvZGl2PlwiKS5oaWRlKClcbiAgICAgIClcbiAgICAgIC5hcHBlbmQoXG4gICAgICAgICQoXG4gICAgICAgICAgXCI8ZGl2IGNsYXNzPSdmaWxlVGFiJyBpZD0nZmlsZVRhYnNUZXh0dXJlJz5cIiArIFwiPGRpdiBjbGFzcz0ndGFiT3V0cHV0JyBpZD0ndGV4dHVyZU91dHB1dCcgLz5cIiArIFwiPC9kaXY+XCJcbiAgICAgICAgKS5oaWRlKClcbiAgICAgIClcbiAgICAgIC5hcHBlbmQoJChcIjxkaXYgY2xhc3M9J2ZpbGVUYWInIGlkPSdmaWxlVGFic1N0cmluZyc+XCIgKyBcIjxkaXYgaWQ9J3N0cmluZ091dHB1dCcgLz5cIiArIFwiPC9kaXY+XCIpLmhpZGUoKSlcbiAgICAgIC5hcHBlbmQoJChcIjxkaXYgY2xhc3M9J2ZpbGVUYWInIGlkPSdmaWxlVGFic01vZGVsJz5cIiArIFwiPGRpdiBpZD0nbW9kZWxPdXRwdXQnLz5cIiArIFwiPC9kaXY+XCIpLmhpZGUoKSlcbiAgICAgIC5hcHBlbmQoXG4gICAgICAgICQoXCI8ZGl2IGNsYXNzPSdmaWxlVGFiJyBpZD0nZmlsZVRhYnNTb3VuZCc+XCIgKyBcIjxkaXYgY2xhc3M9J3RhYk91dHB1dCcgaWQ9J3NvdW5kT3V0cHV0Jy8+XCIgKyBcIjwvZGl2PlwiKS5oaWRlKClcbiAgICAgICk7XG5cbiAgICAkKFwiI2ZpbGVUYWJzXCIpLncydGFicyh7XG4gICAgICBuYW1lOiBcImZpbGVUYWJzXCIsXG4gICAgICBhY3RpdmU6IFwidGFiUmF3XCIsXG4gICAgICB0YWJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogXCJ0YWJSYXdcIixcbiAgICAgICAgICBjYXB0aW9uOiBcIlJhd1wiLFxuICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoXCIuZmlsZVRhYlwiKS5oaWRlKCk7XG4gICAgICAgICAgICAkKFwiI2ZpbGVUYWJzUmF3XCIpLnNob3coKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6IFwidGFiUEZcIixcbiAgICAgICAgICBjYXB0aW9uOiBcIlBhY2sgRmlsZVwiLFxuICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoXCIuZmlsZVRhYlwiKS5oaWRlKCk7XG4gICAgICAgICAgICAkKFwiI2ZpbGVUYWJzUGFja1wiKS5zaG93KCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiBcInRhYlRleHR1cmVcIixcbiAgICAgICAgICBjYXB0aW9uOiBcIlRleHR1cmVcIixcbiAgICAgICAgICBkaXNhYmxlZDogdHJ1ZSxcbiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKFwiLmZpbGVUYWJcIikuaGlkZSgpO1xuICAgICAgICAgICAgJChcIiNmaWxlVGFic1RleHR1cmVcIikuc2hvdygpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogXCJ0YWJTdHJpbmdcIixcbiAgICAgICAgICBjYXB0aW9uOiBcIlN0cmluZ1wiLFxuICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoXCIuZmlsZVRhYlwiKS5oaWRlKCk7XG4gICAgICAgICAgICAkKFwiI2ZpbGVUYWJzU3RyaW5nXCIpLnNob3coKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6IFwidGFiTW9kZWxcIixcbiAgICAgICAgICBjYXB0aW9uOiBcIk1vZGVsXCIsXG4gICAgICAgICAgZGlzYWJsZWQ6IHRydWUsXG4gICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJChcIi5maWxlVGFiXCIpLmhpZGUoKTtcbiAgICAgICAgICAgICQoXCIjZmlsZVRhYnNNb2RlbFwiKS5zaG93KCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiBcInRhYlNvdW5kXCIsXG4gICAgICAgICAgY2FwdGlvbjogXCJTb3VuZFwiLFxuICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoXCIuZmlsZVRhYlwiKS5oaWRlKCk7XG4gICAgICAgICAgICAkKFwiI2ZpbGVUYWJzU291bmRcIikuc2hvdygpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgLy8vIFNldCB1cCBncmlkIGZvciBzdHJpbmdzIHZpZXdcbiAgICAvLy9DcmVhdGUgZ3JpZFxuICAgICQoXCIjc3RyaW5nT3V0cHV0XCIpLncyZ3JpZCh7XG4gICAgICBuYW1lOiBcInN0cmluZ0dyaWRcIixcbiAgICAgIHNlbGVjdFR5cGU6IFwiY2VsbFwiLFxuICAgICAgc2hvdzoge1xuICAgICAgICB0b29sYmFyOiB0cnVlLFxuICAgICAgICBmb290ZXI6IHRydWUsXG4gICAgICB9LFxuICAgICAgY29sdW1uczogW1xuICAgICAgICB7IGZpZWxkOiBcInJlY2lkXCIsIGNhcHRpb246IFwiUm93ICNcIiwgc2l6ZTogXCI2MHB4XCIgfSxcbiAgICAgICAgeyBmaWVsZDogXCJ2YWx1ZVwiLCBjYXB0aW9uOiBcIlRleHRcIiwgc2l6ZTogXCIxMDAlXCIgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICAvKlxuICAgICAgICAgICAgU0VUIFVQIFRSRUUgM0QgU0NFTkVcbiAgICAgICAgKi9cbiAgICBzZXR1cFNjZW5lKCk7XG5cbiAgICAvLy8gQXNrIGZvciBmaWxlXG4gICAgdzJwb3B1cC5vcGVuKHtcbiAgICAgIHNwZWVkOiAwLFxuICAgICAgdGl0bGU6IFwiTG9hZCBBIEdXMiBkYXRcIixcbiAgICAgIG1vZGFsOiB0cnVlLFxuICAgICAgc2hvd0Nsb3NlOiBmYWxzZSxcbiAgICAgIGJvZHk6XG4gICAgICAgICc8ZGl2IGNsYXNzPVwidzJ1aS1jZW50ZXJlZFwiPicgK1xuICAgICAgICAnPGRpdiBpZD1cImZpbGVMb2FkUHJvZ3Jlc3NcIiAvPicgK1xuICAgICAgICAnPGlucHV0IGlkPVwiZmlsZVBpY2tlclBvcFwiIHR5cGU9XCJmaWxlXCIgLz4nICtcbiAgICAgICAgXCI8L2Rpdj5cIixcbiAgICB9KTtcblxuICAgICQoXCIjZmlsZVBpY2tlclBvcFwiKS5jaGFuZ2UoZnVuY3Rpb24gKGV2dCkge1xuICAgICAgX2xyID0gVDNELmdldExvY2FsUmVhZGVyKGV2dC50YXJnZXQuZmlsZXNbMF0sIG9uUmVhZGVyQ3JlYXRlZCwgXCIuL3N0YXRpYy90M2R3b3JrZXIuanNcIik7XG4gICAgfSk7XG5cbiAgICAvLy8gT3ZlcndyaXRlIHByb2dyZXNzIGxvZ2dlclxuICAgIFQzRC5Mb2dnZXIubG9nRnVuY3Rpb25zW1QzRC5Mb2dnZXIuVFlQRV9QUk9HUkVTU10gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAkKFwiI2ZpbGVQaWNrZXJQb3BcIikucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgJChcIiNmaWxlTG9hZFByb2dyZXNzXCIpLmh0bWwoXCJJbmRleGluZyAuZGF0IGZpbGUgKGZpcnN0IHZpc2l0IG9ubHkpPGJyLz5cIiArIGFyZ3VtZW50c1sxXSArIFwiJTxici8+PGJyLz5cIik7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gb25SZWFkZXJDcmVhdGVkKCkge1xuICAgIFQzRC5nZXRGaWxlTGlzdEFzeW5jKFxuICAgICAgX2xyLFxuICAgICAgZnVuY3Rpb24gKGZpbGVzKSB7XG4gICAgICAgIC8vLyBTdG9yZSBmaWxlTGlzdCBnbG9iYWxseVxuICAgICAgICBfZmlsZUxpc3QgPSBmaWxlcztcblxuICAgICAgICBjb25zdCBwYWNrTm9kZSA9IHtcbiAgICAgICAgICBpZDogXCJwYWNrR3JvdXBcIixcbiAgICAgICAgICB0ZXh0OiBcIlBhY2sgRmlsZXNcIixcbiAgICAgICAgICBpbWc6IFwiaWNvbi1mb2xkZXJcIixcbiAgICAgICAgICBncm91cDogZmFsc2UsXG4gICAgICAgICAgbm9kZXM6IFtdLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHRleHR1cmVOb2RlID0ge1xuICAgICAgICAgIGlkOiBcInRleHR1cmVHcm91cFwiLFxuICAgICAgICAgIHRleHQ6IFwiVGV4dHVyZSBmaWxlc1wiLFxuICAgICAgICAgIGltZzogXCJpY29uLWZvbGRlclwiLFxuICAgICAgICAgIGdyb3VwOiBmYWxzZSxcbiAgICAgICAgICBub2RlczogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgdW5zb3J0ZWROb2RlID0ge1xuICAgICAgICAgIGlkOiBcInVuc29ydGVkR3JvdXBcIixcbiAgICAgICAgICB0ZXh0OiBcIlVuc29ydGVkXCIsXG4gICAgICAgICAgaW1nOiBcImljb24tZm9sZGVyXCIsXG4gICAgICAgICAgZ3JvdXA6IGZhbHNlLFxuICAgICAgICAgIG5vZGVzOiBbXSxcbiAgICAgICAgfTtcblxuICAgICAgICAvLy8gQnVpbGQgc2lkZWJhciBub2Rlc1xuICAgICAgICBmb3IgKGNvbnN0IGZpbGVUeXBlIGluIF9maWxlTGlzdCkge1xuICAgICAgICAgIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhfZmlsZUxpc3QpLmluY2x1ZGVzKGZpbGVUeXBlKSkge1xuICAgICAgICAgICAgbGV0IG5vZGUgPSB7IGlkOiBmaWxlVHlwZSwgaW1nOiBcImljb24tZm9sZGVyXCIsIGdyb3VwOiBmYWxzZSB9O1xuICAgICAgICAgICAgLy9sZXQgaXNQYWNrID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAoZmlsZVR5cGUuc3RhcnRzV2l0aChcIlRFWFRVUkVcIikpIHtcbiAgICAgICAgICAgICAgbm9kZSA9IHtcbiAgICAgICAgICAgICAgICBpZDogZmlsZVR5cGUsXG4gICAgICAgICAgICAgICAgaW1nOiBcImljb24tZm9sZGVyXCIsXG4gICAgICAgICAgICAgICAgZ3JvdXA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRleHQ6IGZpbGVUeXBlLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICB0ZXh0dXJlTm9kZS5ub2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlVHlwZSA9PT0gXCJCSU5BUklFU1wiKSB7XG4gICAgICAgICAgICAgIG5vZGUudGV4dCA9IFwiQmluYXJpZXNcIjtcbiAgICAgICAgICAgICAgdzJ1aS5zaWRlYmFyLmFkZChub2RlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZVR5cGUgPT09IFwiU1RSSU5HU1wiKSB7XG4gICAgICAgICAgICAgIG5vZGUudGV4dCA9IFwiU3RyaW5nc1wiO1xuICAgICAgICAgICAgICB3MnVpLnNpZGViYXIuYWRkKG5vZGUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlVHlwZS5zdGFydHNXaXRoKFwiUEZcIikpIHtcbiAgICAgICAgICAgICAgbm9kZSA9IHtcbiAgICAgICAgICAgICAgICBpZDogZmlsZVR5cGUsXG4gICAgICAgICAgICAgICAgaW1nOiBcImljb24tZm9sZGVyXCIsXG4gICAgICAgICAgICAgICAgZ3JvdXA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRleHQ6IGZpbGVUeXBlLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBwYWNrTm9kZS5ub2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlVHlwZSA9PT0gXCJVTktOT1dOXCIpIHtcbiAgICAgICAgICAgICAgbm9kZS50ZXh0ID0gXCJVbmtub3duXCI7XG4gICAgICAgICAgICAgIHcydWkuc2lkZWJhci5hZGQobm9kZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBub2RlID0ge1xuICAgICAgICAgICAgICAgIGlkOiBmaWxlVHlwZSxcbiAgICAgICAgICAgICAgICBpbWc6IFwiaWNvbi1mb2xkZXJcIixcbiAgICAgICAgICAgICAgICBncm91cDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGV4dDogZmlsZVR5cGUsXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIHVuc29ydGVkTm9kZS5ub2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYWNrTm9kZS5ub2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdzJ1aS5zaWRlYmFyLmFkZChwYWNrTm9kZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGV4dHVyZU5vZGUubm9kZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHcydWkuc2lkZWJhci5hZGQodGV4dHVyZU5vZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHVuc29ydGVkTm9kZS5ub2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdzJ1aS5zaWRlYmFyLmFkZCh1bnNvcnRlZE5vZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8vIENsb3NlIHRoZSBwb3BcbiAgICAgICAgdzJwb3B1cC5jbG9zZSgpO1xuXG4gICAgICAgIC8vLyBTZWxlY3QgdGhlIFwiQWxsXCIgY2F0ZWdvcnlcbiAgICAgICAgdzJ1aS5zaWRlYmFyLmNsaWNrKFwiQWxsXCIpO1xuICAgICAgfSAvLy8gRW5kIGdldEZpbGVMaXN0QXN5bmMgY2FsbGJhY2tcbiAgICApO1xuICB9XG5cbiAgZnVuY3Rpb24gb25GaWx0ZXJDbGljayhldnQpIHtcbiAgICAvLy8gTm8gZmlsdGVyIGlmIGNsaWNrZWQgZ3JvdXAgd2FzIFwiQWxsXCJcbiAgICBpZiAoZXZ0LnRhcmdldCA9PT0gXCJBbGxcIikge1xuICAgICAgc2hvd0ZpbGVHcm91cCgpO1xuICAgIH1cblxuICAgIC8vLyBPdGhlciBldmVudHMgYXJlIGZpbmUgdG8ganVzdCBwYXNzXG4gICAgZWxzZSB7XG4gICAgICBzaG93RmlsZUdyb3VwKFtldnQudGFyZ2V0XSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc2hvd0ZpbGVHcm91cChmaWxlVHlwZUZpbHRlcikge1xuICAgIHcydWkuZ3JpZC5yZWNvcmRzID0gW107XG5cbiAgICBjb25zdCByZXZlcnNlVGFibGUgPSBfbHIuZ2V0UmV2ZXJzZUluZGV4KCk7XG5cbiAgICBmb3IgKGNvbnN0IGZpbGVUeXBlIGluIF9maWxlTGlzdCkge1xuICAgICAgLy8vIE9ubHkgc2hvdyB0eXBlcyB3ZSd2ZSBhc2tlZCBmb3JcbiAgICAgIGlmIChmaWxlVHlwZUZpbHRlciAmJiBmaWxlVHlwZUZpbHRlci5pbmRleE9mKGZpbGVUeXBlKSA8IDApIHtcbiAgICAgICAgLy8vIFNwZWNpYWwgY2FzZSBmb3IgXCJwYWNrR3JvdXBcIlxuICAgICAgICAvLy8gU2hvdWxkIGxldCB0cm91Z2ggYWxsIHBhY2sgdHlwZXNcbiAgICAgICAgLy8vIFNob3VsZCBOT1QgbGV0IHRyb3VnaHQgYW55IG5vbi1wYWNrIHR5cGVzXG4gICAgICAgIC8vLyBpLmUuIFN0cmluZ3MsIEJpbmFyaWVzIGV0Y1xuICAgICAgICBpZiAoZmlsZVR5cGVGaWx0ZXIuaW5kZXhPZihcInBhY2tHcm91cFwiKSA+PSAwKSB7XG4gICAgICAgICAgaWYgKCFmaWxlVHlwZS5zdGFydHNXaXRoKFwiUEZcIikpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChmaWxlVHlwZUZpbHRlci5pbmRleE9mKFwidGV4dHVyZUdyb3VwXCIpID49IDApIHtcbiAgICAgICAgICBpZiAoIWZpbGVUeXBlLnN0YXJ0c1dpdGgoXCJURVhUVVJFXCIpKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKE9iamVjdC5rZXlzKF9maWxlTGlzdCkuaW5jbHVkZXMoZmlsZVR5cGUpKSB7XG4gICAgICAgIGNvbnN0IGZpbGVBcnIgPSBfZmlsZUxpc3RbZmlsZVR5cGVdO1xuICAgICAgICBmaWxlQXJyLmZvckVhY2goXG4gICAgICAgICAgZnVuY3Rpb24gKG1mdEluZGV4KSB7XG4gICAgICAgICAgICBjb25zdCBtZXRhID0gX2xyLmdldEZpbGVNZXRhKG1mdEluZGV4KTtcblxuICAgICAgICAgICAgY29uc3QgYmFzZUlkcyA9IHJldmVyc2VUYWJsZVttZnRJbmRleF07XG4gICAgICAgICAgICBjb25zdCBmaWxlU2l6ZSA9IG1ldGEgPyBtZXRhLnNpemUgOiBcIlwiO1xuXG4gICAgICAgICAgICBpZiAoZmlsZVNpemUgPiAwICYmIG1mdEluZGV4ID4gMTUpIHtcbiAgICAgICAgICAgICAgdzJ1aVtcImdyaWRcIl0ucmVjb3Jkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICByZWNpZDogbWZ0SW5kZXgsIC8vLyBNRlQgaW5kZXhcbiAgICAgICAgICAgICAgICBiYXNlSWRzOiBiYXNlSWRzLFxuICAgICAgICAgICAgICAgIHR5cGU6IGZpbGVUeXBlLFxuICAgICAgICAgICAgICAgIGZpbGVTaXplOiBmaWxlU2l6ZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG1mdEluZGV4Kys7XG4gICAgICAgICAgfSAvLy8gRW5kIGZvciBlYWNoIG1mdCBpbiB0aGlzIGZpbGUgdHlwZVxuICAgICAgICApO1xuICAgICAgfSAvLy8gRW5kIGlmIF9maWxlTGlzdFtmaWxldHlwZV1cbiAgICB9IC8vLyBFbmQgZm9yIGVhY2ggZmlsZVR5cGUga2V5IGluIF9maWxlTGlzdCBvYmplY3RcblxuICAgIC8vLyBVcGRhdGUgZmlsZSBncmlkXG4gICAgdzJ1aS5ncmlkLnJlZnJlc2goKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHZpZXdGaWxlQnlNRlQobWZ0SWR4KSB7XG4gICAgY29uc3QgcmV2ZXJzZVRhYmxlID0gX2xyLmdldFJldmVyc2VJbmRleCgpO1xuXG4gICAgY29uc3QgYmFzZUlkID0gcmV2ZXJzZVRhYmxlW21mdElkeF0gPyByZXZlcnNlVGFibGVbbWZ0SWR4XVswXSA6IFwiXCI7XG5cbiAgICB2aWV3RmlsZUJ5RmlsZUlkKGJhc2VJZCk7XG4gIH1cblxuICBmdW5jdGlvbiB2aWV3RmlsZUJ5RmlsZUlkKGZpbGVJZCkge1xuICAgIC8vLyBDbGVhbiBvdXRwdXRzXG4gICAgJChcIi50YWJPdXRwdXRcIikuaHRtbChcIlwiKTtcbiAgICAkKFwiI2ZpbGVUaXRsZVwiKS5odG1sKFwiXCIpO1xuXG4gICAgLy8vIENsZWFuIGNvbnRleHQgdG9vbGJhclxuICAgICQoXCIjY29udGV4dFRvb2xiYXJcIikuaHRtbChcIlwiKTtcblxuICAgIC8vLyBEaXNhYmxlIHRhYnNcbiAgICB3MnVpLmZpbGVUYWJzLmRpc2FibGUoXCJ0YWJSYXdcIik7XG4gICAgdzJ1aS5maWxlVGFicy5kaXNhYmxlKFwidGFiUEZcIik7XG4gICAgdzJ1aS5maWxlVGFicy5kaXNhYmxlKFwidGFiVGV4dHVyZVwiKTtcbiAgICB3MnVpLmZpbGVUYWJzLmRpc2FibGUoXCJ0YWJTdHJpbmdcIik7XG4gICAgdzJ1aS5maWxlVGFicy5kaXNhYmxlKFwidGFiTW9kZWxcIik7XG4gICAgdzJ1aS5maWxlVGFicy5kaXNhYmxlKFwidGFiU291bmRcIik7XG5cbiAgICAvLy8gUmVtb3ZlIG9sZCBtb2RlbHMgZnJvbSB0aGUgc2NlbmVcbiAgICBpZiAoX21vZGVscykge1xuICAgICAgX21vZGVscy5mb3JFYWNoKGZ1bmN0aW9uIChtZGwpIHtcbiAgICAgICAgX3NjZW5lLnJlbW92ZShtZGwpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8vIE1ha2Ugc3VyZSBfY29udGV4dCBpcyBjbGVhblxuICAgIF9jb250ZXh0ID0ge307XG5cbiAgICAvLy8gUnVuIHRoZSBiYXNpYyBEYXRhUmVuZGVyZXIsIGhhbmRsZXMgYWxsIHNvcnRzIG9mIGZpbGVzIGZvciB1cy5cbiAgICBUM0QucnVuUmVuZGVyZXIoVDNELkRhdGFSZW5kZXJlciwgX2xyLCB7IGlkOiBmaWxlSWQgfSwgX2NvbnRleHQsIG9uQmFzaWNSZW5kZXJlckRvbmUpO1xuICB9XG5cbiAgZnVuY3Rpb24gb25CYXNpY1JlbmRlcmVyRG9uZSgpIHtcbiAgICAvLy8gUmVhZCByZW5kZXIgb3V0cHV0IGZyb20gX2NvbnRleHQgVk9cbiAgICBjb25zdCBmaWxlSWQgPSAoX2ZpbGVJZCA9IFQzRC5nZXRDb250ZXh0VmFsdWUoX2NvbnRleHQsIFQzRC5EYXRhUmVuZGVyZXIsIFwiZmlsZUlkXCIpKTtcblxuICAgIGNvbnN0IHJhd0RhdGEgPSBUM0QuZ2V0Q29udGV4dFZhbHVlKF9jb250ZXh0LCBUM0QuRGF0YVJlbmRlcmVyLCBcInJhd0RhdGFcIik7XG5cbiAgICBjb25zdCByYXcgPSBUM0QuZ2V0Q29udGV4dFZhbHVlKF9jb250ZXh0LCBUM0QuRGF0YVJlbmRlcmVyLCBcInJhd1N0cmluZ1wiKTtcblxuICAgIGNvbnN0IHBhY2tmaWxlID0gVDNELmdldENvbnRleHRWYWx1ZShfY29udGV4dCwgVDNELkRhdGFSZW5kZXJlciwgXCJmaWxlXCIpO1xuXG4gICAgY29uc3QgaW1hZ2UgPSBUM0QuZ2V0Q29udGV4dFZhbHVlKF9jb250ZXh0LCBUM0QuRGF0YVJlbmRlcmVyLCBcImltYWdlXCIpO1xuXG4gICAgY29uc3QgZmNjID0gcmF3LnN1YnN0cmluZygwLCA0KTtcblxuICAgIC8vLyBVcGRhdGUgbWFpbiBoZWFkZXIgdG8gc2hvdyBmaWxlbmFtZVxuXG4gICAgY29uc3QgZmlsZU5hbWUgPSBmaWxlSWQgKyAoaW1hZ2UgfHwgIXBhY2tmaWxlID8gXCIuXCIgKyBmY2MgOiBcIi5cIiArIHBhY2tmaWxlLmhlYWRlci50eXBlKTtcbiAgICAkKFwiI2ZpbGVUaXRsZVwiKS5odG1sKGZpbGVOYW1lKTtcblxuICAgIC8vLyBVcGRhdGUgcmF3IHZpZXcgYW5kIGVuYWJsZSB0YWJcbiAgICB3MnVpLmZpbGVUYWJzLmVuYWJsZShcInRhYlJhd1wiKTtcblxuICAgICQoXCIjY29udGV4dFRvb2xiYXJcIikuYXBwZW5kKFxuICAgICAgJChcIjxidXR0b24+RG93bmxvYWQgcmF3PC9idXR0b24+XCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtyYXdEYXRhXSwgeyB0eXBlOiBcIm9jdGV0L3N0cmVhbVwiIH0pO1xuICAgICAgICBzYXZlRGF0YShibG9iLCBmaWxlTmFtZSArIFwiLnJhd1wiKTtcbiAgICAgIH0pXG4gICAgKTtcblxuICAgICQoXCIjcmF3T3V0cHV0XCIpLmFwcGVuZCgkKFwiPGRpdj5cIikudGV4dChyYXcpKTtcblxuICAgIGNvbnN0IHVpOGFSYXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkocmF3RGF0YSk7XG5cbiAgICAvLy8gVGV4dHVyZSBmaWxlXG4gICAgaWYgKGltYWdlKSB7XG4gICAgICAvLy8gU2VsZWN0IHRleHR1cmUgdGFiXG4gICAgICB3MnVpLmZpbGVUYWJzLmVuYWJsZShcInRhYlRleHR1cmVcIik7XG4gICAgICB3MnVpLmZpbGVUYWJzLmNsaWNrKFwidGFiVGV4dHVyZVwiKTtcblxuICAgICAgLy8vIERpc3BsYXkgYml0bWFwIG9uIGNhbnZhc1xuICAgICAgY29uc3QgY2FudmFzID0gJChcIjxjYW52YXM+XCIpO1xuICAgICAgY2FudmFzWzBdLndpZHRoID0gaW1hZ2Uud2lkdGg7XG4gICAgICBjYW52YXNbMF0uaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0O1xuICAgICAgY29uc3QgY3R4ID0gY2FudmFzWzBdLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIGNvbnN0IHVpY2EgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoaW1hZ2UuZGF0YSk7XG4gICAgICBjb25zdCBpbWFnZWRhdGEgPSBuZXcgSW1hZ2VEYXRhKHVpY2EsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpO1xuICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZWRhdGEsIDAsIDApO1xuXG4gICAgICAkKFwiI3RleHR1cmVPdXRwdXRcIikuYXBwZW5kKGNhbnZhcyk7XG4gICAgfVxuXG4gICAgLy8gUE5HIHRleHR1cmVcbiAgICBlbHNlIGlmIChcbiAgICAgIHVpOGFSYXdEYXRhLmxlbmd0aCA+IDQgJiZcbiAgICAgIHVpOGFSYXdEYXRhWzBdID09PSAxMzcgJiZcbiAgICAgIHVpOGFSYXdEYXRhWzFdID09PSA4MCAmJiAvLyBQXG4gICAgICB1aThhUmF3RGF0YVsyXSA9PT0gNzggJiYgLy8gTlxuICAgICAgdWk4YVJhd0RhdGFbM10gPT09IDcxIC8vIEdcbiAgICApIHtcbiAgICAgIC8vLyBTZWxlY3QgdGV4dHVyZSB0YWJcbiAgICAgIHcydWkuZmlsZVRhYnMuZW5hYmxlKFwidGFiVGV4dHVyZVwiKTtcbiAgICAgIHcydWkuZmlsZVRhYnMuY2xpY2soXCJ0YWJUZXh0dXJlXCIpO1xuXG4gICAgICBjb25zdCBjYW52YXMgPSAkKFwiPGNhbnZhcz5cIik7XG4gICAgICBjb25zdCBwbmdCbG9iID0gbmV3IEJsb2IoW3Jhd0RhdGFdLCB7IHR5cGU6IFwiaW1hZ2UvcG5nXCIgfSk7XG4gICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKHBuZ0Jsb2IpO1xuICAgICAgY29uc3QgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjYW52YXNbMF0ud2lkdGggPSBpbWcud2lkdGg7XG4gICAgICAgIGNhbnZhc1swXS5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xuICAgICAgICBjb25zdCBjdHggPSBjYW52YXNbMF0uZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMsIDAsIDApO1xuICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG4gICAgICB9O1xuICAgICAgaW1nLnNyYyA9IHVybDtcbiAgICAgICQoXCIjdGV4dHVyZU91dHB1dFwiKS5hcHBlbmQoY2FudmFzKTtcbiAgICAgICQoXCIjY29udGV4dFRvb2xiYXJcIilcbiAgICAgICAgLnNob3coKVxuICAgICAgICAuYXBwZW5kKFxuICAgICAgICAgICQoXCI8YnV0dG9uPkRvd25sb2FkIEltYWdlPC9idXR0b24+XCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbcmF3RGF0YV0sIHsgdHlwZTogXCJvY3RldC9zdHJlYW1cIiB9KTtcbiAgICAgICAgICAgIHNhdmVEYXRhKGJsb2IsIGZpbGVJZCArIFwiLnBuZ1wiKTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8vIFJJRkYgdGV4dHVyZVxuICAgIGVsc2UgaWYgKFxuICAgICAgdWk4YVJhd0RhdGEubGVuZ3RoID4gNCAmJlxuICAgICAgdWk4YVJhd0RhdGFbMF0gPT09IDgyICYmIC8vIFJcbiAgICAgIHVpOGFSYXdEYXRhWzFdID09PSA3MyAmJiAvLyBJXG4gICAgICB1aThhUmF3RGF0YVsyXSA9PT0gNzAgJiYgLy8gRlxuICAgICAgdWk4YVJhd0RhdGFbM10gPT09IDcwIC8vIEZcbiAgICApIHtcbiAgICAgIC8vLyBTZWxlY3QgdGV4dHVyZSB0YWJcbiAgICAgIHcydWkuZmlsZVRhYnMuZW5hYmxlKFwidGFiVGV4dHVyZVwiKTtcbiAgICAgIHcydWkuZmlsZVRhYnMuY2xpY2soXCJ0YWJUZXh0dXJlXCIpO1xuXG4gICAgICBjb25zdCBjYW52YXMgPSAkKFwiPGNhbnZhcz5cIik7XG4gICAgICBjb25zdCByaWZmQmxvYiA9IG5ldyBCbG9iKFtyYXdEYXRhXSwgeyB0eXBlOiBcImltYWdlL3dlYnBcIiB9KTtcbiAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwocmlmZkJsb2IpO1xuICAgICAgY29uc3QgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjYW52YXNbMF0ud2lkdGggPSBpbWcud2lkdGg7XG4gICAgICAgIGNhbnZhc1swXS5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xuICAgICAgICBjb25zdCBjdHggPSBjYW52YXNbMF0uZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMsIDAsIDApO1xuICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG4gICAgICB9O1xuICAgICAgaW1nLnNyYyA9IHVybDtcbiAgICAgICQoXCIjdGV4dHVyZU91dHB1dFwiKS5hcHBlbmQoY2FudmFzKTtcbiAgICAgICQoXCIjY29udGV4dFRvb2xiYXJcIilcbiAgICAgICAgLnNob3coKVxuICAgICAgICAuYXBwZW5kKFxuICAgICAgICAgICQoXCI8YnV0dG9uPkRvd25sb2FkIEltYWdlPC9idXR0b24+XCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbcmF3RGF0YV0sIHsgdHlwZTogXCJvY3RldC9zdHJlYW1cIiB9KTtcbiAgICAgICAgICAgIHNhdmVEYXRhKGJsb2IsIGZpbGVJZCArIFwiLnJpZmZcIik7XG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvLy8gUEYgUGFjayBmaWxlXG4gICAgZWxzZSBpZiAocGFja2ZpbGUpIHtcbiAgICAgIC8vLyBBbHdheXMgcmVuZGVyIHRoZSBwYWNrIGZpbGUgY2h1bmsgZGF0YVxuICAgICAgZGlzcGxheVBhY2tGaWxlKCk7XG5cbiAgICAgIC8vLyBFbmFibGUgY29ycmVzcG9uZGluZyB0YWJcbiAgICAgIHcydWkuZmlsZVRhYnMuZW5hYmxlKFwidGFiUEZcIik7XG5cbiAgICAgIC8vLyBJZiB0aGUgcGFjayBmaWxlIHdhcyBhIG1vZGVsLCByZW5kZXIgaXQhXG4gICAgICBpZiAocGFja2ZpbGUuaGVhZGVyLnR5cGUgPT09IFwiTU9ETFwiKSB7XG4gICAgICAgIC8vLyBSZW5kZXIgbW9kZWxcbiAgICAgICAgcmVuZGVyRmlsZU1vZGVsKGZpbGVJZCk7XG4gICAgICB9IGVsc2UgaWYgKHBhY2tmaWxlLmhlYWRlci50eXBlID09PSBcIkFTTkRcIikge1xuICAgICAgICAvLy8gR2V0IGEgY2h1bmssIHRoaXMgaXMgcmVhbGx5IHRoZSBqb2Igb2YgYSByZW5kZXJlciBidXQgd2hhdGV2c1xuICAgICAgICBjb25zdCBjaHVuayA9IHBhY2tmaWxlLmdldENodW5rKFwiQVNORFwiKTtcblxuICAgICAgICAvLy8gRW5hYmxlIGFuZCBzZWxlY3Qgc291bmQgdGFiXG4gICAgICAgIHcydWkuZmlsZVRhYnMuZW5hYmxlKFwidGFiU291bmRcIik7XG4gICAgICAgIHcydWkuZmlsZVRhYnMuY2xpY2soXCJ0YWJTb3VuZFwiKTtcblxuICAgICAgICAvLy8gUHJpbnQgc29tZSByYW5kb20gZGF0YSBhYm91dCB0aGlzIHNvdW5kXG4gICAgICAgICQoXCIjc291bmRPdXRwdXRcIikuaHRtbChcbiAgICAgICAgICBcIkxlbmd0aDogXCIgKyBjaHVuay5kYXRhLmxlbmd0aCArIFwiIHNlY29uZHM8YnIvPlwiICsgXCJTaXplOiBcIiArIGNodW5rLmRhdGEuYXVkaW9EYXRhLmxlbmd0aCArIFwiIGJ5dGVzXCJcbiAgICAgICAgKTtcblxuICAgICAgICAvLy8gRXh0cmFjdCBzb3VuZCBkYXRhXG5cbiAgICAgICAgY29uc3Qgc291bmRVaW50QXJyYXkgPSBjaHVuay5kYXRhLmF1ZGlvRGF0YTtcblxuICAgICAgICAkKFwiI2NvbnRleHRUb29sYmFyXCIpXG4gICAgICAgICAgLnNob3coKVxuICAgICAgICAgIC5hcHBlbmQoXG4gICAgICAgICAgICAkKFwiPGJ1dHRvbj5Eb3dubG9hZCBNUDM8L2J1dHRvbj5cIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW3NvdW5kVWludEFycmF5XSwgeyB0eXBlOiBcIm9jdGV0L3N0cmVhbVwiIH0pO1xuICAgICAgICAgICAgICBzYXZlRGF0YShibG9iLCBmaWxlTmFtZSArIFwiLm1wM1wiKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKVxuICAgICAgICAgIC5hcHBlbmQoXG4gICAgICAgICAgICAkKFwiPGJ1dHRvbj5QbGF5IE1QMzwvYnV0dG9uPlwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGlmICghX2F1ZGlvQ29udGV4dCkge1xuICAgICAgICAgICAgICAgIF9hdWRpb0NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAvLy8gU3RvcCBwcmV2aW91cyBzb3VuZFxuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIF9hdWRpb1NvdXJjZS5zdG9wKCk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8vIENyZWF0ZSBuZXcgYnVmZmVyIGZvciBjdXJyZW50IHNvdW5kXG4gICAgICAgICAgICAgIF9hdWRpb1NvdXJjZSA9IF9hdWRpb0NvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICAgICAgICAgIF9hdWRpb1NvdXJjZS5jb25uZWN0KF9hdWRpb0NvbnRleHQuZGVzdGluYXRpb24pO1xuXG4gICAgICAgICAgICAgIC8vLyBEZWNvZGUgYW5kIHN0YXJ0IHBsYXlpbmdcbiAgICAgICAgICAgICAgX2F1ZGlvQ29udGV4dC5kZWNvZGVBdWRpb0RhdGEoc291bmRVaW50QXJyYXkuYnVmZmVyLCBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgICAgX2F1ZGlvU291cmNlLmJ1ZmZlciA9IHJlcztcbiAgICAgICAgICAgICAgICBfYXVkaW9Tb3VyY2Uuc3RhcnQoKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgICAuYXBwZW5kKFxuICAgICAgICAgICAgJChcIjxidXR0b24+U3RvcCBNUDM8L2J1dHRvbj5cIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIF9hdWRpb1NvdXJjZS5zdG9wKCk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLy8gU2VsZWN0IFBGIHRhYlxuICAgICAgICB3MnVpLmZpbGVUYWJzLmNsaWNrKFwidGFiUEZcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChmY2MgPT09IFwic3Ryc1wiKSB7XG4gICAgICBzaG93RmlsZVN0cmluZyhmaWxlSWQpO1xuICAgIH1cblxuICAgIC8vLyBFbHNlIGp1c3Qgc2hvdyByYXcgdmlld1xuICAgIGVsc2Uge1xuICAgICAgdzJ1aS5maWxlVGFicy5jbGljayhcInRhYlJhd1wiKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBkaXNwbGF5UGFja0ZpbGUoKSB7XG4gICAgLy9sZXQgZmlsZUlkID0gVDNELmdldENvbnRleHRWYWx1ZShfY29udGV4dCwgVDNELkRhdGFSZW5kZXJlciwgXCJmaWxlSWRcIik7XG4gICAgY29uc3QgcGFja2ZpbGUgPSBUM0QuZ2V0Q29udGV4dFZhbHVlKF9jb250ZXh0LCBUM0QuRGF0YVJlbmRlcmVyLCBcImZpbGVcIik7XG5cbiAgICAkKFwiI3BhY2tPdXRwdXRcIikuaHRtbChcIlwiKTtcbiAgICAkKFwiI3BhY2tPdXRwdXRcIikuYXBwZW5kKCQoXCI8aDI+Q2h1bmtzPC9oMj5cIikpO1xuXG4gICAgcGFja2ZpbGUuY2h1bmtzLmZvckVhY2goZnVuY3Rpb24gKGNodW5rKSB7XG4gICAgICBjb25zdCBmaWVsZCA9ICQoXCI8ZmllbGRzZXQgLz5cIik7XG4gICAgICBjb25zdCBsZWdlbmQgPSAkKFwiPGxlZ2VuZD5cIiArIGNodW5rLmhlYWRlci50eXBlICsgXCI8L2xlZ2VuZD5cIik7XG5cbiAgICAgIGNvbnN0IGxvZ0J1dHRvbiA9ICQoXCI8YnV0dG9uPkxvZyBDaHVuayBEYXRhIHRvIENvbnNvbGU8L2J1dHRvbj5cIik7XG4gICAgICBsb2dCdXR0b24uY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBUM0QuTG9nZ2VyLmxvZyhUM0QuTG9nZ2VyLlRZUEVfTUVTU0FHRSwgXCJMb2dnaW5nXCIsIGNodW5rLmhlYWRlci50eXBlLCBcImNodW5rXCIpO1xuICAgICAgICBUM0QuTG9nZ2VyLmxvZyhUM0QuTG9nZ2VyLlRZUEVfTUVTU0FHRSwgY2h1bmsuZGF0YSk7XG4gICAgICB9KTtcblxuICAgICAgZmllbGQuYXBwZW5kKGxlZ2VuZCk7XG4gICAgICBmaWVsZC5hcHBlbmQoJChcIjxwPlNpemU6XCIgKyBjaHVuay5oZWFkZXIuY2h1bmtEYXRhU2l6ZSArIFwiPC9wPlwiKSk7XG4gICAgICBmaWVsZC5hcHBlbmQobG9nQnV0dG9uKTtcblxuICAgICAgJChcIiNwYWNrT3V0cHV0XCIpLmFwcGVuZChmaWVsZCk7XG4gICAgICAkKFwiI3BhY2tPdXRwdXRcIikuc2hvdygpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvd0ZpbGVTdHJpbmcoZmlsZUlkKSB7XG4gICAgLy8vIE1ha2Ugc3VyZSBvdXRwdXQgaXMgY2xlYW5cbiAgICBfY29udGV4dCA9IHt9O1xuXG4gICAgLy8vIFJ1biBzaW5nbGUgcmVuZGVyZXJcbiAgICBUM0QucnVuUmVuZGVyZXIoVDNELlN0cmluZ1JlbmRlcmVyLCBfbHIsIHsgaWQ6IGZpbGVJZCB9LCBfY29udGV4dCwgb25SZW5kZXJlckRvbmVTdHJpbmcpO1xuICB9XG5cbiAgZnVuY3Rpb24gb25SZW5kZXJlckRvbmVTdHJpbmcoKSB7XG4gICAgLy8vIFJlYWQgZGF0YSBmcm9tIHJlbmRlcmVyXG4gICAgY29uc3Qgc3RyaW5ncyA9IFQzRC5nZXRDb250ZXh0VmFsdWUoX2NvbnRleHQsIFQzRC5TdHJpbmdSZW5kZXJlciwgXCJzdHJpbmdzXCIsIFtdKTtcblxuICAgIHcydWkuc3RyaW5nR3JpZC5yZWNvcmRzID0gc3RyaW5ncztcblxuICAgIHcydWkuc3RyaW5nR3JpZC5idWZmZXJlZCA9IHcydWkuc3RyaW5nR3JpZC5yZWNvcmRzLmxlbmd0aDtcbiAgICB3MnVpLnN0cmluZ0dyaWQudG90YWwgPSB3MnVpLnN0cmluZ0dyaWQuYnVmZmVyZWQ7XG4gICAgdzJ1aS5zdHJpbmdHcmlkLnJlZnJlc2goKTtcblxuICAgIC8vLyBTZWxlY3QgdGhpcyB2aWV3XG4gICAgdzJ1aS5maWxlVGFicy5lbmFibGUoXCJ0YWJTdHJpbmdcIik7XG4gICAgdzJ1aS5maWxlVGFicy5jbGljayhcInRhYlN0cmluZ1wiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlckZpbGVNb2RlbChmaWxlSWQpIHtcbiAgICBjb25zdCBwYWNrZmlsZSA9IFQzRC5nZXRDb250ZXh0VmFsdWUoX2NvbnRleHQsIFQzRC5EYXRhUmVuZGVyZXIsIFwiZmlsZVwiKTtcbiAgICBjb25zdCBoYXNNb2RlbCA9IHBhY2tmaWxlLmNodW5rcy5maW5kKChjaHVuaykgPT4gY2h1bmsuaGVhZGVyLnR5cGUgPT09IFwiTU9ETFwiKTtcblxuICAgIC8vLyBNYWtlIHN1cmUgb3V0cHV0IGlzIGNsZWFuXG4gICAgX2NvbnRleHQgPSB7fTtcblxuICAgIGlmIChoYXNNb2RlbCkge1xuICAgICAgLy8vIFJ1biBzaW5nbGUgcmVuZGVyZXJcbiAgICAgIFQzRC5ydW5SZW5kZXJlcihUM0QuU2luZ2xlTW9kZWxSZW5kZXJlciwgX2xyLCB7IGlkOiBmaWxlSWQgfSwgX2NvbnRleHQsIG9uUmVuZGVyZXJEb25lTW9kZWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICB3MnVpLmZpbGVUYWJzLmNsaWNrKFwidGFiUEZcIik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gb25SZW5kZXJlckRvbmVNb2RlbCgpIHtcbiAgICAvLy8gRW5hYmxlIGFuZCBzZWxlY3QgbW9kZWwgdGFiXG4gICAgdzJ1aS5maWxlVGFicy5lbmFibGUoXCJ0YWJNb2RlbFwiKTtcbiAgICB3MnVpLmZpbGVUYWJzLmNsaWNrKFwidGFiTW9kZWxcIik7XG4gICAgJChcIiNtb2RlbE91dHB1dFwiKS5zaG93KCk7XG5cbiAgICAvLy8gUmUtZml0IGNhbnZhc1xuICAgIG9uQ2FudmFzUmVzaXplKCk7XG5cbiAgICAvLy8gQWRkIGNvbnRleHQgdG9vbGJhciBleHBvcnQgYnV0dG9uXG4gICAgJChcIiNjb250ZXh0VG9vbGJhclwiKS5hcHBlbmQoJChcIjxidXR0b24+RXhwb3J0IHNjZW5lPC9idXR0b24+XCIpLmNsaWNrKGV4cG9ydFNjZW5lKSk7XG5cbiAgICAvLy8gUmVhZCB0aGUgbmV3IG1vZGVsc1xuICAgIF9tb2RlbHMgPSBUM0QuZ2V0Q29udGV4dFZhbHVlKF9jb250ZXh0LCBUM0QuU2luZ2xlTW9kZWxSZW5kZXJlciwgXCJtZXNoZXNcIiwgW10pO1xuXG4gICAgLy8vIEtlZXBpbmcgdHJhY2sgb2YgdGhlIGJpZ2dlc3QgbW9kZWwgZm9yIGxhdGVyXG4gICAgbGV0IGJpZ2dlc3RNZGwgPSBudWxsO1xuXG4gICAgLy8vIEFkZCBhbGwgbW9kZWxzIHRvIHRoZSBzY2VuZVxuICAgIF9tb2RlbHMuZm9yRWFjaChmdW5jdGlvbiAobW9kZWwpIHtcbiAgICAgIC8vLyBGaW5kIHRoZSBiaWdnZXN0IG1vZGVsIGZvciBjYW1lcmEgZm9jdXMvZml0dGluZ1xuICAgICAgaWYgKCFiaWdnZXN0TWRsIHx8IGJpZ2dlc3RNZGwuYm91bmRpbmdTcGhlcmUucmFkaXVzIDwgbW9kZWwuYm91bmRpbmdTcGhlcmUucmFkaXVzKSB7XG4gICAgICAgIGJpZ2dlc3RNZGwgPSBtb2RlbDtcbiAgICAgIH1cblxuICAgICAgX3NjZW5lLmFkZChtb2RlbCk7XG4gICAgfSk7XG5cbiAgICAvLy8gUmVzZXQgYW55IHpvb20gYW5kIHRyYW5zYWx0aW9uL3JvdGF0aW9uIGRvbmUgd2hlbiB2aWV3aW5nIGVhcmxpZXIgbW9kZWxzLlxuICAgIF9jb250cm9scy5yZXNldCgpO1xuXG4gICAgLy8vIEZvY3VzIGNhbWVyYSB0byB0aGUgYmlnZXN0IG1vZGVsLCBkb2Vzbid0IHdvcmsgZ3JlYXQuXG4gICAgbGV0IGRpc3QgPVxuICAgICAgYmlnZ2VzdE1kbCAmJiBiaWdnZXN0TWRsLmJvdW5kaW5nU3BoZXJlID8gYmlnZ2VzdE1kbC5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgLyBNYXRoLnRhbigoTWF0aC5QSSAqIDYwKSAvIDM2MCkgOiAxMDA7XG4gICAgZGlzdCA9IDEuMiAqIE1hdGgubWF4KDEwMCwgZGlzdCk7XG4gICAgZGlzdCA9IE1hdGgubWluKDEwMDAsIGRpc3QpO1xuICAgIF9jYW1lcmEucG9zaXRpb24uem9vbSA9IDE7XG4gICAgX2NhbWVyYS5wb3NpdGlvbi54ID0gZGlzdCAqIE1hdGguc3FydCgyKTtcbiAgICBfY2FtZXJhLnBvc2l0aW9uLnkgPSA1MDtcbiAgICBfY2FtZXJhLnBvc2l0aW9uLnogPSAwO1xuXG4gICAgaWYgKGJpZ2dlc3RNZGwpIF9jYW1lcmEubG9va0F0KGJpZ2dlc3RNZGwucG9zaXRpb24pO1xuICB9XG5cbiAgLy8vIEV4cG9ydHMgY3VycmVudCBtb2RlbCBhcyBhbiAub2JqIGZpbGUgd2l0aCBhIC5tdGwgcmVmZXJpbmcgLnBuZyB0ZXh0dXJlcy5cbiAgZnVuY3Rpb24gZXhwb3J0U2NlbmUoKSB7XG4gICAgLy8vIEdldCBsYXN0IGxvYWRlZCBmaWxlSWRcbiAgICBjb25zdCBmaWxlSWQgPSBfZmlsZUlkO1xuXG4gICAgLy8vIFJ1biBUM0QgaGFja2VkIHZlcnNpb24gb2YgT0JKRXhwb3J0ZXJcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgVEhSRUUuT0JKRXhwb3J0ZXIoKS5wYXJzZShfc2NlbmUsIGZpbGVJZCk7XG5cbiAgICAvLy8gRG93bmxvYWQgb2JqXG4gICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtyZXN1bHRdLCB7IHR5cGU6IFwib2N0ZXQvc3RyZWFtXCIgfSk7XG4gICAgc2F2ZURhdGEoYmxvYiwgXCJleHBvcnQuXCIgKyBmaWxlSWQgKyBcIi5vYmpcIik7XG4gIH1cblxuICAvLy8gVXRpbGl0eSBmb3IgZG93bmxvYWRpbmcgZmlsZXMgdG8gY2xpZW50XG4gIGNvbnN0IHNhdmVEYXRhID0gKGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTtcbiAgICBhLnN0eWxlID0gXCJkaXNwbGF5OiBub25lXCI7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChibG9iLCBmaWxlTmFtZSkge1xuICAgICAgY29uc3QgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICBhLmhyZWYgPSB1cmw7XG4gICAgICBhLmRvd25sb2FkID0gZmlsZU5hbWU7XG4gICAgICBhLmNsaWNrKCk7XG4gICAgICB3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICAgIH07XG4gIH0pKCk7XG5cbiAgLy8vIFNldHRpbmcgdXAgYSBzY2VuZSwgVHJlZS5qcyBzdGFuZGFyZCBzdHVmZi4uLlxuICBmdW5jdGlvbiBzZXR1cFNjZW5lKCkge1xuICAgIGNvbnN0IGNhbnZhc1dpZHRoID0gJChcIiNtb2RlbE91dHB1dFwiKS53aWR0aCgpO1xuICAgIGNvbnN0IGNhbnZhc0hlaWdodCA9ICQoXCIjbW9kZWxPdXRwdXRcIikuaGVpZ2h0KCk7XG4gICAgY29uc3QgY2FudmFzQ2xlYXJDb2xvciA9IDB4MzQyOTIwOyAvLyBGb3IgaGFwcHkgcmVuZGVyaW5nLCBhbHdheXMgdXNlIFZhbiBEeWtlIEJyb3duLlxuICAgIGNvbnN0IGZvdiA9IDYwO1xuICAgIGNvbnN0IGFzcGVjdCA9IDE7XG4gICAgY29uc3QgbmVhciA9IDAuMTtcbiAgICBjb25zdCBmYXIgPSA1MDAwMDA7XG5cbiAgICBfY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIpO1xuXG4gICAgX3NjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG5cbiAgICAvLy8gVGhpcyBzY2VuZSBoYXMgb25lIGFtYmllbnQgbGlnaHQgc291cmNlIGFuZCB0aHJlZSBkaXJlY3Rpb25hbCBsaWdodHNcbiAgICBjb25zdCBhbWJpZW50TGlnaHQgPSBuZXcgVEhSRUUuQW1iaWVudExpZ2h0KDB4NTU1NTU1KTtcbiAgICBfc2NlbmUuYWRkKGFtYmllbnRMaWdodCk7XG5cbiAgICBjb25zdCBkaXJlY3Rpb25hbExpZ2h0MSA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmLCAwLjgpO1xuICAgIGRpcmVjdGlvbmFsTGlnaHQxLnBvc2l0aW9uLnNldCgwLCAwLCAxKTtcbiAgICBfc2NlbmUuYWRkKGRpcmVjdGlvbmFsTGlnaHQxKTtcblxuICAgIGNvbnN0IGRpcmVjdGlvbmFsTGlnaHQyID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoMHhmZmZmZmYsIDAuOCk7XG4gICAgZGlyZWN0aW9uYWxMaWdodDIucG9zaXRpb24uc2V0KDEsIDAsIDApO1xuICAgIF9zY2VuZS5hZGQoZGlyZWN0aW9uYWxMaWdodDIpO1xuXG4gICAgY29uc3QgZGlyZWN0aW9uYWxMaWdodDMgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZiwgMC44KTtcbiAgICBkaXJlY3Rpb25hbExpZ2h0My5wb3NpdGlvbi5zZXQoMCwgMSwgMCk7XG4gICAgX3NjZW5lLmFkZChkaXJlY3Rpb25hbExpZ2h0Myk7XG5cbiAgICAvLy8gU3RhbmRhcmQgVEhSRUUgcmVuZGVyZXIgd2l0aCBBQVxuICAgIF9yZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHsgYW50aWFsaWFzaW5nOiB0cnVlIH0pO1xuICAgICQoXCIjbW9kZWxPdXRwdXRcIilbMF0uYXBwZW5kQ2hpbGQoX3JlbmRlcmVyLmRvbUVsZW1lbnQpO1xuXG4gICAgX3JlbmRlcmVyLnNldFNpemUoY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodCk7XG4gICAgX3JlbmRlcmVyLnNldENsZWFyQ29sb3IoY2FudmFzQ2xlYXJDb2xvcik7XG5cbiAgICAvLy8gQWRkIFRIUkVFIG9yYml0IGNvbnRyb2xzLCBmb3Igc2ltcGxlIG9yYml0aW5nLCBwYW5uaW5nIGFuZCB6b29taW5nXG4gICAgX2NvbnRyb2xzID0gbmV3IFRIUkVFLk9yYml0Q29udHJvbHMoX2NhbWVyYSwgX3JlbmRlcmVyLmRvbUVsZW1lbnQpO1xuICAgIF9jb250cm9scy5lbmFibGVab29tID0gdHJ1ZTtcblxuICAgIC8vLyBTZW1zIHcydWkgZGVsYXlzIHJlc2l6aW5nIDovXG4gICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbiAoKSB7XG4gICAgICBzZXRUaW1lb3V0KG9uQ2FudmFzUmVzaXplLCAxMCk7XG4gICAgfSk7XG5cbiAgICAvLy8gTm90ZTogY29uc3RhbnQgY29udGlub3VzIHJlbmRlcmluZyBmcm9tIHBhZ2UgbG9hZCBldmVudCwgbm90IHZlcnkgb3B0LlxuICAgIHJlbmRlcigpO1xuICB9XG5cbiAgZnVuY3Rpb24gb25DYW52YXNSZXNpemUoKSB7XG4gICAgY29uc3Qgc2NlbmVXaWR0aCA9ICQoXCIjbW9kZWxPdXRwdXRcIikud2lkdGgoKTtcbiAgICBjb25zdCBzY2VuZUhlaWdodCA9ICQoXCIjbW9kZWxPdXRwdXRcIikuaGVpZ2h0KCk7XG5cbiAgICBpZiAoIXNjZW5lSGVpZ2h0IHx8ICFzY2VuZVdpZHRoKSByZXR1cm47XG5cbiAgICBfY2FtZXJhLmFzcGVjdCA9IHNjZW5lV2lkdGggLyBzY2VuZUhlaWdodDtcblxuICAgIF9yZW5kZXJlci5zZXRTaXplKHNjZW5lV2lkdGgsIHNjZW5lSGVpZ2h0KTtcblxuICAgIF9jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpO1xuICB9XG5cbiAgLy8vIFJlbmRlciBsb29wLCBubyBnYW1lIGxvZ2ljLCBqdXN0IHJlbmRlcmluZy5cbiAgZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTtcbiAgICBfcmVuZGVyZXIucmVuZGVyKF9zY2VuZSwgX2NhbWVyYSk7XG4gIH1cbn07XG4iXX0="}